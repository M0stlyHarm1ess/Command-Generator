<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Command Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* 主色调 - 浅蓝色 */
            --primary-color: #60a5fa;
            --primary-hover: #3b82f6;
            --primary-light: #93c5fd;
            /* 侧边栏深灰蓝色 */
            --sidebar-color: #3b4c62;
            --sidebar-hover: #2a3a4d;
            /* 辅助色 */
            --success-color: #34d399;
            --error-color: #f87171;
            --error-color-hover: #ef4444;
            --warning-color: #fbbf24;
            /* 中性色 */
            --bg-color: #f8fafc;
            --surface-color: #ffffff;
            --border-color: #e2e8f0;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --text-muted: #94a3b8;
            /* 阴影 */
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
            /* 圆角 */
            --border-radius-sm: 8px;
            --border-radius-md: 12px;
            --border-radius-lg: 16px;
            /* 过渡 */
            --transition: all 0.2s ease;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background: linear-gradient(135deg, #1e293b 0%, #334155 50%, #475569 100%);
            color: var(--text-primary);
            line-height: 1.6;
            font-size: 14px;
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }

        /* 主容器 */
        .container {
            display: flex;
            height: 90vh;
            background-color: var(--sidebar-color);
            max-width: 1600px;
            margin: 5vh auto;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15), 0 10px 20px rgba(0, 0, 0, 0.1);
            border-radius: 24px;
            overflow: hidden;
            transform: translateY(-2px) translateZ(0);
            backface-visibility: hidden;
            border: 1px solid var(--sidebar-color);
        }

        /* 左侧Tab栏 */
        .tab-sidebar {
            width: 220px;
            background: var(--sidebar-color);
            color: white;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* 标题卡片 - 现代化命令行LOGO设计 */
        .tab-header {
            padding: 1.5rem 1rem;
            background: var(--sidebar-hover);
            color: #10b981;
            font-size: 1.4rem;
            font-weight: 700;
            text-align: center;
            margin: 0;
            
            /* 使用更具命令行风格的字体 */
            font-family: 'Courier New', 'Consolas', 'Monaco', 'Andale Mono', 'Ubuntu Mono', monospace;
            
            /* 调整文字效果 - 更暗的颜色匹配 */
            text-shadow: 0 0 8px rgba(16, 185, 129, 0.8);
            
            /* 移除默认before伪元素 */
        }
        
        /* 闪烁下划线光标 - 放在Command后面 */
        .tab-header span.cursor {
            display: inline-block;
            width: 10px;
            height: 2px;
            background-color: #34d399;
            margin-left: 0.2rem;
            vertical-align: bottom;
            animation: blink 1s steps(2, start) infinite;
            position: relative;
            top: -2px;
        }
        
        /* Generator特殊样式 - 增强机械感设计 */
        .tab-header span.generator {
            /* 选择更具未来机械感的字体组合 */
            font-family: 'Orbitron', 'Rajdhani', 'Roboto Mono', 'Courier New', monospace;
            /* 超粗体，增强机械厚重感 */
            font-weight: 900;
            /* 默认就显示发亮状态 */
            color: #e0ffff;
            /* 调整后的机械感文字效果 - 减小光晕 */
            text-shadow: 
                0 0 3px rgba(224, 255, 255, 0.9),
                0 0 6px rgba(224, 255, 255, 0.7),
                0 0 9px rgba(30, 144, 255, 0.5);
            /* 机械设计元素 */
            letter-spacing: 2px; /* 更大的字间距，增强机械感 */
            font-size: 1.8rem; /* 进一步增大字号 */
            text-transform: uppercase;
            /* 移除所有装饰效果，只保留文字 */
            padding: 0;
            border: none;
            outline: none;
            background: none;
            box-shadow: none;
            border-radius: 0;
            /* 基本样式 */
            position: relative;
            display: inline-block;
            /* 增加与command文本的间距 */
            margin-top: 0.2rem;
        }
        
        /* 为Command和Generator之间添加空格 */
        .tab-header span.cursor {
            margin-right: 0.5rem;
        }
        

        
        @keyframes blink {
            to {
                visibility: hidden;
            }
        }
        
        /* 响应式设计 */
        @media (max-width: 768px) {
            .tab-header {
                font-size: 1.1rem;
                padding: 1rem 0.5rem;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 0.3rem;
                flex-wrap: wrap;
            }
            
            /* 隐藏原来的光标 */
            .tab-header span.cursor {
                display: none;
            }
            
            /* 在Generator后面添加新的光标 */
            .tab-header span.generator::after {
                content: '';
                display: inline-block;
                width: 10px;
                height: 2px;
                background-color: #34d399;
                margin-left: 0.2rem;
                vertical-align: bottom;
                animation: blink 1s steps(2, start) infinite;
                position: relative;
                top: 0;
            }
            
            /* 在Command和Generator之间添加连字符连接 */
            .tab-header span.generator::before {
                content: '-';
                color: #e0ffff;
                margin: 0 0.2rem;
            }
            
            .tab-header span.generator {
                font-size: 1.1rem;
                letter-spacing: 1px;
                margin-top: 0;
                font-weight: 700;
                text-shadow: 0 0 3px rgba(224, 255, 255, 0.9);
            }
        }
        
        /* 极小屏幕适配 */
        @media (max-width: 480px) {
            .tab-header {
                font-size: 0.9rem;
                padding: 0.8rem 0.4rem;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 0.2rem;
                flex-wrap: wrap;
            }
            
            /* 隐藏原来的光标 */
            .tab-header span.cursor {
                display: none;
            }
            
            /* 在Generator后面添加新的光标 */
            .tab-header span.generator::after {
                content: '';
                display: inline-block;
                width: 8px;
                height: 2px;
                background-color: #34d399;
                margin-left: 0.2rem;
                vertical-align: bottom;
                animation: blink 1s steps(2, start) infinite;
                position: relative;
                top: 0;
            }
            
            /* 在Command和Generator之间添加连字符连接 */
            .tab-header span.generator::before {
                content: '-';
                color: #e0ffff;
                margin: 0 0.2rem;
            }
            
            .tab-header span.generator {
                font-size: 0.9rem;
                letter-spacing: 1px;
                margin-top: 0;
                font-weight: 700;
                text-shadow: 0 0 3px rgba(224, 255, 255, 0.9);
            }
        }

        /* 左侧Tab栏菜单 */
        .tab-list {
            padding: 1.5rem 0;
            flex: 1;
            overflow-y: auto;
            max-height: calc(100vh - 200px);
        }
        
        /* 自定义滚动条样式 */
        .tab-list::-webkit-scrollbar {
            width: 6px;
        }
        
        .tab-list::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .tab-list::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
        }
        
        .tab-list::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }



        .tab-item {
            padding: 0.875rem 1.5rem;
            cursor: pointer;
            transition: var(--transition);
            display: block;
            background: transparent;
            border: none;
            margin: 0;
            font-weight: 500;
            color: white;
            text-decoration: none;
            border-radius: 0;
            box-shadow: none;
        }

        .tab-item:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        /* 顶部分栏的选中效果 - 保留上浮效果 */
        .tab-item.active {
            background: #f8fafc;
            color: var(--text-primary);
            border-radius: 8px 0 0 8px;
            margin: 0 0 0 1rem;
            box-shadow: none;
            transform: translateY(-2px);
            border: none;
            outline: none;
            position: relative;
            z-index: 2;
        }

        /* 底部管理面板的选中效果 - 无上浮效果 */
        .tab-item.management-active {
            background: rgba(248, 250, 252, 0.9);
            color: var(--text-primary);
            border-radius: 0;
            margin: 0 !important;
            padding: 0.875rem 1.5rem !important;
            box-shadow: none !important;
            transform: none !important;
            border: none;
            outline: none;
            position: static !important;
            top: auto !important;
            bottom: auto !important;
            left: auto !important;
            right: auto !important;
            z-index: 1 !important;
            height: auto !important;
            min-height: 0 !important;
            max-height: none !important;
            transition: background-color 0.2s ease, color 0.2s ease !important;
        }

        /* 管理面板标签显示控制 */
        /* 大屏模式下的默认显示规则 */
        .management-tab {
            display: none;
        }
        
        .management-container {
            display: block;
        }
        
        /* 小屏幕模式下的管理面板标签显示 */
        @media (max-width: 768px) {
            .management-tab {
                display: block;
            }
            
            .management-container {
                display: none;
            }
        }
        
        /* 主内容区域 */
        .main-content {
            flex: 1;
            display: flex;
            background-color: #f8fafc;
            overflow: hidden;
            border-left: none;
            position: relative;
            z-index: 1;
            margin: 0;
            padding: 0;
            border-radius: 0 24px 24px 0;
            transform: translateZ(0);
            backface-visibility: hidden;
        }

        /* Tab内容区域 */
        .tab-content {
            display: none;
            flex: 1;
            overflow: hidden;
            background-color: #f8fafc;
        }



        .tab-content.active {
            display: flex;
        }

        /* 命令显示区 */
        .commands-section {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
            background-color: var(--bg-color);
            max-height: 100%;
        }

        /* 右侧变量区 */
        .variables-section {
            width: 320px;
            padding: 2rem;
            background-color: var(--bg-color);
            border-left: 1px solid var(--border-color);
            overflow-y: auto;
            max-height: 100%;
        }

        /* 管理页面样式 */
        .management-page {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
            background-color: var(--bg-color);
            max-height: 100%;
        }
        
        /* 命令项 */
        .command-item {
            background-color: var(--surface-color);
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            transition: var(--transition);
            margin-bottom: 1rem;
        }

        .command-item:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-1px);
        }

        .command-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .command-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            line-height: 1.4;
        }

        .command-actions {
            display: flex;
            gap: 0.75rem;
        }

        .edit-btn, .delete-btn, .save-btn, .cancel-btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: var(--border-radius-sm);
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .edit-btn, .save-btn {
            background-color: var(--primary-color);
            color: white;
        }

        .delete-btn {
            background-color: #f87171;
            color: white;
        }

        .cancel-btn {
            background-color: var(--bg-color);
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
        }

        .edit-btn:hover, .save-btn:hover {
            background-color: var(--primary-hover);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .delete-btn:hover {
            background-color: #ef4444;
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .cancel-btn:hover {
            background-color: var(--border-color);
            color: var(--text-primary);
        }

        /* 命令描述 */
        .command-description {
            color: var(--text-secondary);
            margin: 0.75rem 0;
            line-height: 1.5;
        }



        /* 代码块 */
        .code-block {
            position: relative;
            background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
            color: #e2e8f0;
            padding: 1.5rem;
            border-radius: 8px;
            font-family: 'SF Mono', 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', monospace;
            font-size: 1rem;
            overflow-x: auto;
            box-shadow: var(--shadow-md);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .code-block pre {
            margin: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: 'SF Mono', 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', monospace;
            font-size: 1rem;
            padding-right: 80px; /* 为复制按钮留出空间 */
        }

        /* 复制按钮 */
        .copy-btn {
            position: absolute;
            top: 50%;
            right: 0.75rem;
            transform: translateY(-50%);
            background-color: rgba(128, 128, 128, 0.5);
            color: white;
            border: none;
            padding: 0.4rem 0.8rem;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            min-width: 60px;
            text-align: center;
        }

        .copy-btn:hover {
            background-color: rgba(128, 128, 128, 0.7);
            transform: translateY(calc(-50% - 1px));
        }

        .copy-btn.copied {
            background-color: var(--success-color);
            animation: pulse 0.6s ease-in-out;
            transform: translateY(-50%);
        }

        @keyframes pulse {
            0%, 100% {
                transform: translateY(-50%) scale(1);
            }
            50% {
                transform: translateY(-50%) scale(1.05);
            }
        }

        .variables-section h2, .commands-section h2, .management-page h2 {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .management-page h3 {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1.25rem;
        }

        /* 变量项 */
        .variable-item {
            background-color: var(--surface-color);
            border-radius: 8px;
            padding: 1rem;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            transition: var(--transition);
            margin-bottom: 1rem;
        }

        .variable-item:hover {
            box-shadow: var(--shadow-md);
        }

        .variable-name {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .variable-value {
            background-color: var(--bg-color);
            border: 1px solid var(--border-color);
            padding: 0.75rem;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 0.9rem;
            color: var(--text-primary);
            transition: var(--transition);
            word-wrap: break-word;
            overflow-wrap: break-word;
            white-space: normal;
            min-height: 1.5rem;
        }

        .variable-value:hover {
            border-color: var(--primary-color);
            background-color: var(--surface-color);
            box-shadow: var(--shadow-sm);
        }

        .variable-value.editing {
            background-color: var(--surface-color);
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
            width: 100%;
            box-sizing: border-box;
        }

        /* 添加表单 */
        .add-variable-form, .add-command-form {
            background-color: var(--surface-color);
            padding: 1.5rem;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            margin-bottom: 2rem;
            transition: var(--transition);
            box-shadow: var(--shadow-sm);
        }

        .add-variable-form:hover, .add-command-form:hover {
            box-shadow: var(--shadow-md);
        }

        /* 输入框样式 */
        input[type="text"],
        textarea,
        select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-sm);
            font-size: 0.9rem;
            transition: var(--transition);
            background-color: var(--surface-color);
            color: var(--text-primary);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }

        /* 统一placeholder样式 */
        input::placeholder,
        textarea::placeholder {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            color: var(--text-muted);
            opacity: 1;
        }

        input[type="text"]:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 120px;
            line-height: 1.5;
        }

        /* 标签样式 - 扁平卡通风格 */
        /* 标签样式方案 1：简约风格 */
        /*
        .tag {
            display: inline-block;
            background: var(--surface-color);
            color: var(--text-primary);
            padding: 0.3rem 0.6rem;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 500;
            margin-right: 0.4rem;
            margin-bottom: 0.4rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            transition: all 0.2s ease;
            border: 1px solid var(--border-color);
        }

        .tag:hover {
            background: var(--primary-color);
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.15);
        }
        */

        /* 标签样式方案 2：彩色风格（如需使用，取消注释并注释掉方案1）
        .tag {
            display: inline-block;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: all 0.2s ease;
        }

        .tag:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        */

        /* 标签样式方案 3：极简风格（修改颜色） */
        .tag {
            display: inline-block;
            background: #39c1d0;
            color: white;
            padding: 0.15rem 0.4rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 500;
            margin-right: 0.3rem;
            margin-bottom: 0.3rem;
            transition: all 0.2s ease;
            border: 1px solid #39c1d0;
        }

        .tag:hover {
            background: transparent;
            color: #39c1d0;
            border-color: #39c1d0;
        }
        

        /* 编辑命令模态框 */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: var(--surface-color);
            margin: 1rem;
            padding: 1rem;
            border-radius: var(--border-radius-lg);
            width: 100%;
            max-width: 500px;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-color);
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: scale(0.95) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--border-color);
        }

        .modal-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-muted);
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            border-radius: 50%;
        }

        .close-btn:hover {
            color: var(--text-primary);
            background-color: var(--bg-color);
        }

        .modal-body {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            min-height: 90px;
            align-items: stretch;
            justify-content: flex-start;
        }
        
        /* 确认弹框的body保持居中 */
        #confirmModal .modal-body {
            align-items: center;
            justify-content: center;
        }

        .modal-body p {
            margin: 0;
            line-height: 1.5;
            font-size: 1rem;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 0.75rem;
            margin-top: 1rem;
            padding-top: 0.75rem;
            border-top: 1px solid var(--border-color);
        }



        /* Toast 容器样式 */
        .toast-container {
            position: fixed;
            top: 2rem;
            right: 2rem;
            z-index: 2000;
            height: auto;
        }
        
        /* Toast 提示样式 */
        .toast {
            position: absolute;
            right: 0;
            padding: 1rem 1.5rem;
            border-radius: var(--border-radius-sm);
            color: white;
            font-size: 0.9rem;
            font-weight: 500;
            box-shadow: var(--shadow-md);
            transform: translateX(400px);
            transition: var(--transition);
            background-color: var(--primary-color);
            width: max-content;
            max-width: 300px;
        }
        
        .toast.success {
            background-color: var(--success-color);
        }
        
        .toast.error {
            background-color: var(--error-color);
        }
        
        .toast.warning {
            background-color: var(--warning-color);
            color: var(--text-primary);
        }
        
        /* 表单验证错误样式 */
        .input-error {
            border-color: var(--error-color) !important;
            box-shadow: 0 0 0 3px rgba(247, 37, 133, 0.1) !important;
        }
        
        .error-message {
            color: var(--error-color);
            font-size: 0.8rem;
            margin-top: 0.25rem;
            font-weight: 500;
        }
        
        /* 搜索和筛选区域 */
        #searchInput {
            border: 1px solid var(--border-color);
            transition: var(--transition);
        }
        
        #searchInput:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }
        
        #tagFilterContainer {
            border: 1px solid var(--border-color);
            transition: var(--transition);
        }
        
        #tagFilterContainer:hover {
            border-color: var(--primary-color);
        }
        
        /* 选中标签样式 */
        .selected-tag {
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
            padding: 0.15rem 0.4rem;
            background: #39c1d0;
            color: white;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 500;
            margin-right: 0.3rem;
            margin-bottom: 0.3rem;
            transition: all 0.2s ease;
            border: 1px solid #39c1d0;
        }
        
        /* 拖动排序样式 */
        [draggable="true"] {
            cursor: move;
            transition: box-shadow 0.2s ease;
        }
        
        [draggable="true"].dragging {
            opacity: 0.5;
            box-shadow: var(--shadow-lg);
            transform: none;
        }
        
        [draggable="true"]:hover {
            box-shadow: var(--shadow-md);
        }
        
        /* 插入标记样式 */
        .drag-insert-marker {
            height: 4px;
            background-color: #1e56a0;
            border-radius: 2px;
            margin: 4px 0;
            transition: all 0.2s ease;
        }

        /* 排序按钮样式 */
        .sort-btn {
            padding: 0.5rem 1rem;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: var(--shadow-sm);
        }

        .sort-btn:hover {
            background-color: var(--primary-hover);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .sort-btn.active {
            background-color: var(--success-color);
        }

        .sort-btn.active:hover {
            background-color: #10b981;
        }
        
        .selected-tag:hover {
            background: transparent;
            color: #39c1d0;
            border-color: #39c1d0;
        }
        
        .selected-tag span:last-child {
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.3);
            transition: all 0.2s ease;
            font-weight: bold;
        }
        
        .selected-tag span:last-child:hover {
            background-color: rgba(255, 255, 255, 0.5);
            transform: scale(1.1);
        }
        
        #clearTagsBtn {
            transition: var(--transition);
        }
        
        #clearTagsBtn:hover {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        /* 数据管理区域 */
        .management-page > div {
            margin-bottom: 2rem;
        }

        /* 二级导航内容区域 */
        .sub-tab-content {
            display: none;
        }

        .sub-tab-content.active {
            display: block;
        }

        /* 二级导航标签悬停效果 */
        .sub-tab-item:hover {
            color: var(--primary-color) !important;
            background-color: rgba(96, 165, 250, 0.05);
        }

        
        /* 响应式设计 */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            .tab-sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
                flex-direction: column;
            }
            
            .tab-list {
                display: flex;
                overflow-x: auto;
                padding: 0;
                gap: 0.5rem;
                flex-wrap: nowrap;
                border-bottom: none;
            }
            
            /* 小屏幕下管理面板容器调整 */
            .tab-sidebar > div:not(.tab-list):not(.tab-header):not(.management-container):not(:last-child) {
                display: flex;
                margin-top: 0;
                padding: 0;
                border-top: none;
                border-bottom: none;
                overflow-x: auto;
                gap: 0.5rem;
            }
            
            /* 小屏幕下语言切换按钮位置调整 */
            .language-switcher {
                bottom: auto !important;
                left: auto !important;
                top: 0.5rem !important;
                right: 0.5rem !important;
            }
            
            /* 小屏幕下容器布局调整 - 充满屏幕 */
            .container {
                height: 100vh !important;
                margin: 0 !important;
                border-radius: 0 !important;
            }
            
            /* 小屏幕下移除所有内边距和外边距，让内容充满屏幕 */
            .tab-sidebar {
                padding: 0 !important;
            }
            
            .tab-header {
                padding: 0.75rem 0.5rem !important;
            }
            
            .tab-list {
                padding: 0 !important;
            }
            
            .main-content {
                border-radius: 0 !important;
            }
            
            .commands-section,
            .variables-section,
            .management-page {
                padding: 1rem !important;
            }
            
            .tab-item {
                flex-shrink: 0;
                border-left: none;
                border-bottom: 2px solid transparent;
                padding: 0.75rem 1.25rem !important;
                margin: 0 !important;
                border-radius: 0 !important;
                background: transparent !important;
                color: white !important;
                transform: none !important;
                box-shadow: none !important;
                position: static !important;
                z-index: 1 !important;
                transition: all 0.2s ease !important;
            }
            
            .tab-item.active {
                border-left-color: transparent !important;
                border-bottom-color: var(--primary-light) !important;
                background: rgba(255, 255, 255, 0.1) !important;
                color: white !important;
                transform: none !important;
                box-shadow: none !important;
                margin: 0 !important;
                border-radius: 0 !important;
            }
            
            .tab-item:hover {
                background: rgba(255, 255, 255, 0.1) !important;
            }
            
            .main-content {
                flex-direction: column;
                overflow: auto;
            }
            
            .tab-content {
                overflow: auto !important;
                flex-direction: column;
            }
            
            /* 小屏幕变量管理按钮显示 */
            #variablesToggleBtn {
                display: block !important;
            }
            
            .commands-section {
                padding: 1rem;
                max-height: 100vh !important;
                flex: 1;
            }
            
            .variables-section {
                position: fixed;
                top: 0;
                right: -100%;
                width: 320px;
                height: 100vh;
                border-left: 1px solid var(--border-color);
                border-top: none;
                padding: 2rem;
                background-color: var(--bg-color);
                box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1);
                z-index: 999;
                transition: right 0.3s ease;
                overflow-y: auto;
            }
            
            .variables-section.active {
                right: 0;
            }
            
            .management-page {
                padding: 1rem;
            }
            
            /* 搜索和筛选区域响应式 */
            .commands-section > div:first-of-type {
                flex-wrap: wrap;
                gap: 1rem;
            }
            
            .commands-section > div:first-of-type > div {
                flex: 1;
                min-width: 200px;
            }
            
            /* 管理面板二级导航响应式 */
            .management-page > div:first-of-type > div {
                display: flex;
                overflow-x: auto;
                gap: 0.5rem;
                padding-bottom: 0.5rem;
            }
            
            .sub-tab-item {
                flex-shrink: 0;
                white-space: nowrap;
                padding: 0.5rem 1rem !important;
            }
            
            .modal-content {
                width: 95%;
                margin: 1rem;
                padding: 1.5rem;
            }
            
            .toast {
                right: 1rem;
                left: 1rem;
                position: relative !important;
                width: auto !important;
                max-width: none !important;
                transform: translateX(0) !important;
            }
        }
        
        /* 滚动条样式 */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--bg-color);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }
    </style>
</head>
<body>
    <!-- 主容器 -->
    <div class="container">
        <!-- 左侧Tab栏 -->
        <div class="tab-sidebar">
            <div class="tab-header">&gt; ./Command<span class="cursor"></span> <span class="generator">Generator</span></div>
            <div class="tab-list">
                <div class="tab-item active" data-tab="main">主页面</div>
                <!-- 分栏菜单项将通过JavaScript动态生成 -->
                <!-- 管理面板标签 - 小屏幕模式下显示在同一行 -->
                <div class="tab-item management-tab" data-tab="management">管理面板</div>
            </div>
            <!-- 管理面板标签 - 大屏模式下显示在底部 -->
            <div class="management-container" style="margin-top: auto; padding: 1rem 0 2rem 0; border-top: 1px solid rgba(255, 255, 255, 0.1);">
                <div class="tab-item" data-tab="management">管理面板</div>
            </div>
            <!-- 语言切换按钮 - 放在角落 -->
            <div class="language-switcher" style="position: absolute; bottom: 0.5rem; left: 0.5rem; display: flex; align-items: center; gap: 0.15rem; background-color: rgba(255, 255, 255, 0.05); border-radius: 12px; padding: 1px; cursor: pointer; font-size: 0.65rem; z-index: 10;">
                <button onclick="changeLanguage('zh')" id="lang-zh" style="flex: 1; padding: 0.1rem 0.3rem; font-size: 0.65rem; border: none; border-radius: 10px; background-color: transparent; color: rgba(255, 255, 255, 0.5); cursor: pointer; transition: all 0.3s ease;">ZH</button>
                <button onclick="changeLanguage('en')" id="lang-en" style="flex: 1; padding: 0.1rem 0.3rem; font-size: 0.65rem; border: none; border-radius: 10px; background-color: transparent; color: rgba(255, 255, 255, 0.5); cursor: pointer; transition: all 0.3s ease;">EN</button>
            </div>
        </div>

        <!-- 主内容区域 -->
        <div class="main-content">
            <!-- 主页面 - 命令显示 + 变量赋值 -->
            <div class="tab-content active" id="main">
                <!-- 命令显示区 -->
                <div class="commands-section">
                    <h2>命令列表</h2>
                    
                    <!-- 搜索和筛选区域 - 同一行布局 -->
                    <div style="display: flex; gap: 1rem; margin-bottom: 2rem; align-items: flex-start;">
                        <!-- 搜索框 -->
                        <div style="flex: 2;">
                            <label for="searchInput" style="display: block; font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.5rem;">搜索</label>
                            <div style="display: flex;">
                                <input type="text" id="searchInput" placeholder="搜索命令或描述..." style="flex: 1; padding: 0.5rem; border: 1px solid var(--border-color); border-radius: 4px; font-size: 1rem; min-height: 42px; box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;">
                            </div>
                        </div>
                        
                        <!-- 标签筛选 - 自定义多选下拉框 -->
                        <div style="flex: 1;">
                            <label style="display: block; font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.5rem;">标签筛选</label>
                            <div style="position: relative; display: flex; gap: 0.5rem; align-items: center;">
                                <!-- 下拉框显示区域 -->
                                <div id="tagFilterContainer" style="border: 1px solid var(--border-color); border-radius: 4px; padding: 0.5rem; min-height: 42px; cursor: pointer; background-color: var(--surface-color); display: flex; flex-wrap: wrap; gap: 0.3rem; align-items: center; flex: 1; box-sizing: border-box;">
                                    <span id="tagFilterPlaceholder" style="color: var(--text-muted);">选择标签</span>
                                </div>
                                <!-- 清除按钮 -->
                                <button id="clearTagsBtn" style="padding: 0.3rem 0.8rem; background-color: var(--bg-color); color: var(--text-secondary); border: 1px solid var(--border-color); border-radius: 4px; cursor: pointer; font-size: 0.9rem; min-height: 42px; box-sizing: border-box;">
                                    清除
                                </button>
                                <!-- 下拉框选项区域 -->
                                <div id="tagFilterOptions" style="display: none; position: absolute; top: 100%; left: 0; right: 0; border: 1px solid var(--border-color); border-radius: 4px; background-color: var(--surface-color); box-shadow: var(--shadow-md); max-height: 200px; overflow-y: auto; z-index: 100;">
                                    <!-- 选项将通过JavaScript动态生成 -->
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 小屏幕变量编辑按钮 -->
                    <button id="variablesToggleBtn" class="save-btn" style="position: fixed; bottom: 2rem; right: 2rem; z-index: 1000; padding: 0.75rem 1.5rem; border-radius: 50px; box-shadow: var(--shadow-lg); display: none;">
                        变量管理
                    </button>
                    
                    <div class="commands-list" id="commandsList">
                        <!-- 命令项将通过JavaScript动态生成 -->
                    </div>
                </div>

                <!-- 变量赋值区 -->
                <div class="variables-section">
                    <h2>变量列表</h2>
                    <div class="variables-list" id="variablesList">
                        <!-- 变量项将通过JavaScript动态生成 -->
                    </div>
                </div>
            </div>

            <!-- 命令管理页面 -->
            <div class="tab-content" id="command-management">
                <div class="management-page">
                    <h2>命令管理</h2>
                    
                    <!-- 添加命令表单 -->
                    <div class="add-command-form" style="margin-bottom: 2rem;">
                        <h3>添加新命令</h3>
                        <div style="display: flex; flex-direction: column; gap: 1rem;">
                            <input type="text" id="newCmdTitle" placeholder="命令标题" style="padding: 0.5rem; border: 1px solid var(--border-color); border-radius: var(--border-radius-sm); font-size: 1rem; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;">
                            <textarea id="newCmdDescription" placeholder="命令描述（可选）" style="padding: 0.5rem; border: 1px solid var(--border-color); border-radius: var(--border-radius-sm); font-size: 1rem; min-height: 60px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;"></textarea>
                            <div style="position: relative;">
                            <!-- 标签输入框 -->
                            <div id="newCmdTagsContainer" style="border: 1px solid var(--border-color); border-radius: var(--border-radius-sm); padding: 0.5rem; min-height: 42px; cursor: text; background-color: var(--surface-color); display: flex; flex-wrap: wrap; gap: 0.3rem; align-items: center;">
                                <span id="newCmdTagsPlaceholder" style="color: var(--text-muted);">选择或输入标签</span>
                                <!-- 选中的标签将动态添加到这里 -->
                            </div>
                            <!-- 现有标签选项 -->
                            <div id="newCmdTagsOptions" style="display: none; position: absolute; top: 100%; left: 0; right: 0; border: 1px solid var(--border-color); border-radius: var(--border-radius-sm); background-color: var(--surface-color); box-shadow: var(--shadow-md); max-height: 200px; overflow-y: auto; z-index: 100;">
                                <!-- 现有标签将动态添加到这里 -->
                            </div>
                        </div>
                            <textarea id="newCmdTemplate" placeholder="命令模板（使用${{变量名}}的形式引用变量）" style="padding: 0.5rem; border: 1px solid var(--border-color); border-radius: var(--border-radius-sm); font-size: 1rem; font-family: 'SF Mono', 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', monospace; min-height: 80px;"></textarea>
                            <button onclick="addCommand()" class="save-btn" style="align-self: flex-start;">添加命令</button>
                        </div>
                    </div>
                    
                    <!-- 命令列表 -->
                    <h3>现有命令</h3>
                    <div class="commands-list" id="commandManagementList">
                        <!-- 命令项将通过JavaScript动态生成 -->
                    </div>
                </div>
            </div>

            <!-- 变量管理页面 -->
            <div class="tab-content" id="variable-management">
                <div class="management-page">
                    <h2>参数管理</h2>
                    
                    <!-- 添加变量表单 -->
                    <div class="add-variable-form" style="margin-bottom: 2rem;">
                        <h3>添加新变量</h3>
                        <div style="margin-bottom: 0.5rem;">
                            <input type="text" id="newVarName" placeholder="变量名" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: var(--border-radius-sm); font-size: 1rem; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;">
                        </div>
                        <button onclick="addVariable()" class="save-btn" style="width: 100%;">添加变量</button>
                    </div>
                    
                    <!-- 变量列表 -->
                    <h3>现有变量</h3>
                    <div class="variables-list" id="variableManagementList">
                        <!-- 变量项将通过JavaScript动态生成 -->
                    </div>
                </div>
            </div>

            <!-- 管理面板主页面 -->
            <div class="tab-content" id="management">
                <div class="management-page">
                    <h2>管理面板</h2>
                    
                    <!-- 二级导航菜单 -->
                    <div style="margin-bottom: 2rem;">
                        <div style="display: flex; gap: 1rem; border-bottom: 1px solid var(--border-color); flex-wrap: wrap;">
                            <div class="sub-tab-item active" data-subtab="command-management" style="padding: 0.75rem 1.5rem; cursor: pointer; font-weight: 500; color: var(--primary-color); border-bottom: 2px solid var(--primary-color); transition: var(--transition);">
                                命令管理
                            </div>
                            <div class="sub-tab-item" data-subtab="variable-management" style="padding: 0.75rem 1.5rem; cursor: pointer; font-weight: 500; color: var(--text-secondary); transition: var(--transition);">
                                参数管理
                            </div>
                            <div class="sub-tab-item" data-subtab="column-management" style="padding: 0.75rem 1.5rem; cursor: pointer; font-weight: 500; color: var(--text-secondary); transition: var(--transition);">
                                分栏管理
                            </div>
                            <div class="sub-tab-item" data-subtab="data-management" style="padding: 0.75rem 1.5rem; cursor: pointer; font-weight: 500; color: var(--text-secondary); transition: var(--transition);">
                                数据管理
                            </div>
                        </div>
                    </div>
                    
                    <!-- 二级导航内容区域 -->
                    <div class="sub-tab-content active" id="management-command-management">
                        <!-- 命令管理内容 -->
                        <h3>添加新命令</h3>
                        <div class="add-command-form" style="margin-bottom: 2rem;">
                            <div style="display: flex; flex-direction: column; gap: 1rem;">
                                <input type="text" id="management-newCmdTitle" placeholder="命令标题" style="padding: 0.5rem; border: 1px solid var(--border-color); border-radius: var(--border-radius-sm); font-size: 1rem; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;">
                                <textarea id="management-newCmdDescription" placeholder="命令描述（可选）" style="padding: 0.5rem; border: 1px solid var(--border-color); border-radius: var(--border-radius-sm); font-size: 1rem; min-height: 60px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;"></textarea>
                                <div style="position: relative;">
                                <!-- 标签输入框 -->
                                <div id="management-newCmdTagsContainer" style="border: 1px solid var(--border-color); border-radius: var(--border-radius-sm); padding: 0.5rem; min-height: 42px; cursor: text; background-color: var(--surface-color); display: flex; flex-wrap: wrap; gap: 0.3rem; align-items: center;">
                                    <span id="management-newCmdTagsPlaceholder" style="color: var(--text-muted);">选择或输入标签</span>
                                    <!-- 选中的标签将动态添加到这里 -->
                                </div>
                                <!-- 现有标签选项 -->
                                <div id="management-newCmdTagsOptions" style="display: none; position: absolute; top: 100%; left: 0; right: 0; border: 1px solid var(--border-color); border-radius: var(--border-radius-sm); background-color: var(--surface-color); box-shadow: var(--shadow-md); max-height: 200px; overflow-y: auto; z-index: 100;">
                                    <!-- 现有标签将动态添加到这里 -->
                                </div>
                            </div>
                                <div>
                                    <label for="management-newCmdColumn" style="display: block; font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.5rem;">所属分栏</label>
                                    <div style="position: relative;">
                                        <div id="management-newCmdColumnContainer" style="border: 1px solid var(--border-color); border-radius: var(--border-radius-sm); padding: 0.75rem; cursor: pointer; background-color: var(--surface-color);">
                                            <span id="management-newCmdColumnPlaceholder" style="color: var(--text-muted);">无分栏</span>
                                            <span id="management-newCmdColumnValue" style="color: var(--text-primary); display: none;"></span>
                                        </div>
                                        <!-- 分栏选项列表 -->
                                        <div id="management-newCmdColumnOptions" style="display: none; position: absolute; top: 100%; left: 0; right: 0; border: 1px solid var(--border-color); border-radius: var(--border-radius-sm); background-color: var(--surface-color); box-shadow: var(--shadow-md); max-height: 200px; overflow-y: auto; z-index: 100;">
                                            <!-- 分栏选项将通过JavaScript动态生成 -->
                                        </div>
                                        <!-- 隐藏的输入框，用于存储选中的分栏ID -->
                                        <input type="hidden" id="management-newCmdColumn" value="">
                                    </div>
                                </div>
                                <textarea id="management-newCmdTemplate" placeholder="命令模板（使用${{变量名}}的形式引用变量）" style="padding: 0.5rem; border: 1px solid var(--border-color); border-radius: var(--border-radius-sm); font-size: 1rem; font-family: 'SF Mono', 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', monospace; min-height: 80px;"></textarea>
                                <button onclick="addManagementCommand()" class="save-btn" style="align-self: flex-start;">添加命令</button>
                            </div>
                        </div>
                        
                        <!-- 命令列表 -->
                        <h3>现有命令</h3>
                        <!-- 搜索和筛选区域 -->
                        <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem;">
                            <!-- 搜索框 -->
                            <div style="flex: 1;">
                                <input type="text" id="management-commandSearch" placeholder="搜索命令（标题、描述或模板）" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: var(--border-radius-sm); font-size: 1rem; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;">
                            </div>
                            <!-- 分栏筛选器 -->
                            <div style="width: 200px;">
                                <div style="position: relative;">
                                    <select id="management-columnFilter" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: var(--border-radius-sm); font-size: 1rem; background-color: var(--surface-color); color: var(--text-primary); appearance: none; cursor: pointer;">
                                        <option value="">所有分栏</option>
                                        <!-- 分栏选项将通过JavaScript动态生成 -->
                                    </select>
                                    <div style="position: absolute; right: 0.75rem; top: 50%; transform: translateY(-50%); pointer-events: none; color: var(--text-muted);">▼</div>
                                </div>
                            </div>
                        </div>
                        <div class="commands-list" id="management-commandManagementList">
                            <!-- 命令项将通过JavaScript动态生成 -->
                        </div>
                    </div>
                    
                    <div class="sub-tab-content" id="management-variable-management">
                        <!-- 变量管理内容 -->
                        <h3>添加新变量</h3>
                        <div class="add-variable-form" style="margin-bottom: 2rem;">
                            <div style="margin-bottom: 0.5rem;">
                                <input type="text" id="management-newVarName" placeholder="变量名" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: var(--border-radius-sm); font-size: 1rem; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;">
                            </div>
                            <button onclick="addManagementVariable()" class="save-btn" style="width: 100%;">添加变量</button>
                        </div>
                        
                        <!-- 变量列表 -->
                        <h3>现有变量</h3>
                        <div class="variables-list" id="management-variableManagementList">
                            <!-- 变量项将通过JavaScript动态生成 -->
                        </div>
                    </div>
                    
                    <div class="sub-tab-content" id="management-data-management">
                        <!-- 数据管理内容 -->
                        <h3>数据导出</h3>
                        <div style="margin-bottom: 2rem; padding: 1.5rem; background-color: #f0f2f5; border-radius: 8px;">
                            <p style="margin-bottom: 1rem; color: #666;">将当前所有数据导出为JSON文件，用于备份或迁移。</p>
                            <button onclick="exportData()" class="save-btn">
                                导出数据
                            </button>
                        </div>
                        
                        <h3>数据导入</h3>
                        <div style="margin-bottom: 2rem; padding: 1.5rem; background-color: #f0f2f5; border-radius: 8px;">
                            <p style="margin-bottom: 1rem; color: #666;">从JSON文件导入数据，可以选择全新导入或增量导入。</p>
                            <div style="margin-bottom: 1rem;">
                                <input type="file" id="importFile" accept=".json" style="display: none;">
                                <button type="button" onclick="document.getElementById('importFile').click()" class="save-btn" style="margin-bottom: 1rem;">
                                    选择文件
                                </button>
                                <span id="fileName" style="color: var(--text-secondary); margin-left: 0.5rem;">未选择文件</span>
                            </div>
                            <div style="margin-bottom: 1rem;">
                                <label style="margin-right: 1rem;">
                                    <input type="radio" name="importType" value="full" checked> 全新导入（覆盖现有数据）
                                </label>
                                <label>
                                    <input type="radio" name="importType" value="incremental"> 增量导入（合并现有数据）
                                </label>
                            </div>
                            <button onclick="importData()" class="save-btn">
                                导入数据
                            </button>
                        </div>
                        
                        <h3>清除数据</h3>
                        <div style="padding: 1.5rem; background-color: #fef5f5; border: 1px solid #fed7d7; border-radius: 8px;">
                            <p style="margin-bottom: 1rem; color: #e53e3e;">警告：此操作将永久删除所有数据，包括命令和变量，请谨慎操作！</p>
                            <button onclick="clearAllData()" class="delete-btn">
                                清除所有数据
                            </button>
                        </div>
                    </div>
                    
                    <div class="sub-tab-content" id="management-column-management">
                        <!-- 分栏管理内容 -->
                        <h3>添加新分栏</h3>
                        <div class="add-column-form" style="margin-bottom: 2rem; background-color: var(--surface-color); padding: 1.5rem; border-radius: 8px; border: 1px solid var(--border-color); box-shadow: var(--shadow-sm);">
                            <div style="display: flex; flex-direction: column; gap: 1rem;">
                                <div>
                                    <label for="newColumnName" style="display: block; font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.5rem;">分栏名称</label>
                                    <input type="text" id="newColumnName" placeholder="请输入分栏名称" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: var(--border-radius-sm); font-size: 1rem; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;">
                                </div>
                                <button onclick="addColumn()" class="save-btn" style="align-self: flex-start;">添加分栏</button>
                            </div>
                        </div>
                        
                        <h3>现有分栏</h3>
                        <div class="columns-list" id="columnsList">
                            <!-- 分栏项将通过JavaScript动态生成 -->
                        </div>
                    </div>
                </div>
            </div>


        </div>
    </div>



    <!-- 编辑命令模态框 -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">编辑命令</h3>
                <button class="close-btn" onclick="closeEditModal()">&times;</button>
            </div>
            <div class="modal-body">
                    <div>
                        <label for="editCmdTitle" style="display: block; font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.5rem;">命令标题</label>
                        <input type="text" id="editCmdTitle" placeholder="命令标题" style="padding: 0.5rem; border: 1px solid var(--border-color); border-radius: var(--border-radius-sm); font-size: 1rem; width: 100%; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;">
                        <div id="editCmdTitleError" class="error-message"></div>
                    </div>
                    <div>
                        <label for="editCmdDescription" style="display: block; font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.5rem;">命令描述（可选）</label>
                        <textarea id="editCmdDescription" placeholder="命令描述（可选）" style="padding: 0.5rem; border: 1px solid var(--border-color); border-radius: var(--border-radius-sm); font-size: 1rem; min-height: 60px; width: 100%; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;"></textarea>
                        <div id="editCmdDescriptionError" class="error-message"></div>
                    </div>
                    <div>
                        <label style="display: block; font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.5rem;">选择或输入标签</label>
                        <div style="position: relative;">
                            <!-- 标签输入区域 -->
                            <div id="editCmdTagsContainer" style="border: 1px solid var(--border-color); border-radius: var(--border-radius-sm); padding: 0.5rem; min-height: 42px; cursor: text; background-color: var(--surface-color); display: flex; flex-wrap: wrap; gap: 0.3rem; align-items: center;">
                                <span id="editCmdTagsPlaceholder" style="color: var(--text-muted);">选择或输入标签</span>
                                <!-- 选中的标签将动态添加到这里 -->
                            </div>
                            <!-- 现有标签选项 -->
                            <div id="editCmdTagsOptions" style="display: none; position: absolute; top: 100%; left: 0; right: 0; border: 1px solid var(--border-color); border-radius: var(--border-radius-sm); background-color: var(--surface-color); box-shadow: var(--shadow-md); max-height: 200px; overflow-y: auto; z-index: 100;">
                                <!-- 现有标签将动态添加到这里 -->
                            </div>
                        </div>
                        <div id="editCmdTagsError" class="error-message"></div>
                    </div>
                    <div>
                        <label for="editCmdColumn" style="display: block; font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.5rem;">所属分栏</label>
                        <div style="position: relative;">
                            <div id="editCmdColumnContainer" style="border: 1px solid var(--border-color); border-radius: var(--border-radius-sm); padding: 0.75rem; cursor: pointer; background-color: var(--surface-color);">
                                <span id="editCmdColumnPlaceholder" style="color: var(--text-muted);">无分栏</span>
                                <span id="editCmdColumnValue" style="color: var(--text-primary); display: none;"></span>
                            </div>
                            <!-- 分栏选项列表 -->
                            <div id="editCmdColumnOptions" style="display: none; position: absolute; top: 100%; left: 0; right: 0; border: 1px solid var(--border-color); border-radius: var(--border-radius-sm); background-color: var(--surface-color); box-shadow: var(--shadow-md); max-height: 200px; overflow-y: auto; z-index: 100;">
                                <!-- 分栏选项将通过JavaScript动态生成 -->
                            </div>
                            <!-- 隐藏的输入框，用于存储选中的分栏ID -->
                            <input type="hidden" id="editCmdColumn" value="">
                        </div>
                        <div id="editCmdColumnError" class="error-message"></div>
                    </div>
                    <div>
                        <label for="editCmdTemplate" style="display: block; font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.5rem;">命令模板</label>
                        <textarea id="editCmdTemplate" placeholder="命令模板（使用${{变量名}}的形式引用变量）

# 提示：
# 1. 默认情况下，每行显示为一个代码块
# 2. 使用 ---script--- 和 ---end--- 标记来将多行内容显示为一个代码块
# 3. 示例：
# 命令1（单独代码块）
# ---script---
# 命令2（同一代码块）
# 命令3（同一代码块）
# ---end---
# 命令4（单独代码块）
" style="padding: 0.5rem; border: 1px solid var(--border-color); border-radius: var(--border-radius-sm); font-size: 1rem; font-family: 'SF Mono', 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', monospace; min-height: 200px; width: 100%;"></textarea>
                        <div id="editCmdTemplateError" class="error-message"></div>
                    </div>
                </div>
            <div class="modal-footer">
                <button class="cancel-btn" onclick="closeEditModal()">取消</button>
                <button class="save-btn" onclick="saveEditedCommand()">保存</button>
            </div>
        </div>
    </div>

    <!-- 自定义确认弹框 -->
    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="confirmTitle">确认操作</h3>
                <button class="close-btn" onclick="closeConfirmModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p id="confirmMessage">确定要执行此操作吗？</p>
            </div>
            <div class="modal-footer">
                <button class="cancel-btn" onclick="closeConfirmModal()">取消</button>
                <button class="delete-btn" onclick="confirmAction()">确认</button>
            </div>
        </div>
    </div>

    <!-- 编辑分栏模态框 -->
    <div id="editColumnModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">编辑分栏</h3>
                <button class="close-btn" onclick="closeEditColumnModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div>
                    <input type="text" id="editColumnName" placeholder="分栏名称" style="padding: 0.5rem; border: 1px solid var(--border-color); border-radius: var(--border-radius-sm); font-size: 1rem; width: 100%; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;">
                    <div id="editColumnNameError" class="error-message"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="cancel-btn" onclick="closeEditColumnModal()">取消</button>
                <button class="save-btn" onclick="saveEditedColumn()">保存</button>
            </div>
        </div>
    </div>

    <script>
        // 全局变量声明
        let currentLanguage = 'en';

        
        // 从localStorage加载数据
        function loadData() {
            const savedVariables = localStorage.getItem('commandGeneratorVariables');
            const savedCommands = localStorage.getItem('commandGeneratorCommands');
            const savedColumns = localStorage.getItem('commandGeneratorColumns');
            const savedVariableOrder = localStorage.getItem('commandGeneratorVariableOrder');
            const savedLanguage = localStorage.getItem('commandGeneratorLanguage');
            const hasClearedData = localStorage.getItem('commandGeneratorHasClearedData') === 'true';
            
            // 加载保存的语言设置
            if (savedLanguage) {
                currentLanguage = savedLanguage;
            }
            
            let parsedCommands = [];
            let parsedColumns = [];
            let parsedVariables = {};
            let parsedVariableOrder = [];
            
            if (savedCommands) {
                parsedCommands = JSON.parse(savedCommands);
                // 确保旧数据兼容新格式
                parsedCommands = parsedCommands.map((cmd, index) => ({
                    title: cmd.title,
                    template: cmd.template,
                    description: cmd.description || '',
                    tags: cmd.tags || [],
                    columnId: cmd.columnId || null,
                    sortOrder: cmd.sortOrder !== undefined ? cmd.sortOrder : index
                }));
            } else if (!hasClearedData) {
                // 只有当用户没有手动清除数据时，才显示示例命令
                // 创建两个分栏：Example Column 1和Example Column 2
                parsedColumns = [
                    {
                        id: 'column_example1',
                        name: 'Example Column 1'
                    },
                    {
                        id: 'column_example2',
                        name: 'Example Column 2'
                    }
                ];
                
                // 创建10条命令，每个分栏5条，混合单行和多行命令
                parsedCommands = [
                    // Example Column 1 commands
                    {
                        title: 'List Files',
                        template: 'ls -la ${{PATH}}',
                        description: 'List all files and directories with details',
                        tags: ['shell'],
                        columnId: 'column_example1',
                        sortOrder: 0
                    },
                    {
                        title: 'Create Directory',
                        template: 'mkdir -p ${{PATH}}',
                        description: 'Create a directory with parent directories if needed',
                        tags: ['shell'],
                        columnId: 'column_example1',
                        sortOrder: 1
                    },
                    {
                        title: 'Git Commit',
                        template: '---script---\ngit add .\ngit commit -m "${{MESSAGE}}"\ngit push origin main\n---end---',
                        description: 'Stage changes, commit with message, and push to remote',
                        tags: ['dev'],
                        columnId: 'column_example1',
                        sortOrder: 2
                    },
                    {
                        title: 'Docker Build',
                        template: '---script---\ndocker build -t ${{APP_NAME}}:latest .\ndocker run -p 8080:80 ${{APP_NAME}}:latest\n---end---',
                        description: 'Build a Docker image and run a container',
                        tags: ['ops'],
                        columnId: 'column_example1',
                        sortOrder: 3
                    },
                    {
                        title: 'File Backup',
                        template: 'cp -r ${{PATH}} backup/',
                        description: 'Create a backup of files or directories',
                        tags: ['shell', 'ops'],
                        columnId: 'column_example1',
                        sortOrder: 4
                    },
                    // Example Column 2 commands
                    {
                        title: 'Install Package',
                        template: 'npm install ${{PACKAGE}}',
                        description: 'Install a npm package',
                        tags: ['dev'],
                        columnId: 'column_example2',
                        sortOrder: 5
                    },
                    {
                        title: 'Check Process',
                        template: 'ps aux | grep ${{APP_NAME}}',
                        description: 'Check if a process is running',
                        tags: ['shell'],
                        columnId: 'column_example2',
                        sortOrder: 6
                    },
                    {
                        title: 'Server Update',
                        template: '---script---\nsudo apt update\nsudo apt upgrade -y\nsudo systemctl restart nginx\n---end---',
                        description: 'Update system packages and restart service',
                        tags: ['ops'],
                        columnId: 'column_example2',
                        sortOrder: 7
                    },
                    {
                        title: 'Search Text',
                        template: 'grep -r "${{MESSAGE}}" ${{PATH}}',
                        description: 'Search for text in files recursively',
                        tags: ['shell'],
                        columnId: 'column_example2',
                        sortOrder: 8
                    },
                    {
                        title: 'Git Clone',
                        template: 'git clone ${{REPOSITORY}}',
                        description: 'Clone a git repository',
                        tags: ['dev'],
                        columnId: 'column_example2',
                        sortOrder: 9
                    }
                ];
            }
            
            if (savedColumns) {
                parsedColumns = JSON.parse(savedColumns);
                // 移除旧数据中的order属性，因为我们不再使用它
                parsedColumns = parsedColumns.map(col => ({
                    id: col.id,
                    name: col.name
                }));
            }
            
            if (savedVariables) {
                parsedVariables = JSON.parse(savedVariables);
            } else if (!hasClearedData) {
                // 只有当用户没有手动清除数据时，才显示示例变量
                parsedVariables = {
                    // Common variables
                    PATH: '/home/user',
                    MESSAGE: 'Update files',
                    APP_NAME: 'myapp',
                    PACKAGE: 'express',
                    REPOSITORY: 'https://github.com/user/repo.git'
                };
            }
            
            // 加载变量排序顺序
            if (savedVariableOrder) {
                parsedVariableOrder = JSON.parse(savedVariableOrder);
                // 确保排序顺序中的变量名在parsedVariables中都存在
                parsedVariableOrder = parsedVariableOrder.filter(varName => parsedVariables.hasOwnProperty(varName));
            } else {
                // 如果没有保存的排序顺序，使用变量名的字母顺序
                parsedVariableOrder = Object.keys(parsedVariables).sort();
            }
            
            return {
                variables: parsedVariables,
                variableOrder: parsedVariableOrder,
                commands: parsedCommands,
                columns: parsedColumns
            };
        }

        // Toast 提示函数
        function showToast(message, type = 'success') {
            // 获取或创建toast容器
            let toastContainer = document.querySelector('.toast-container');
            if (!toastContainer) {
                toastContainer = document.createElement('div');
                toastContainer.className = 'toast-container';
                document.body.appendChild(toastContainer);
            }
            
            // 创建新的Toast元素
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            
            // 获取当前容器中的toast数量，设置新toast的top位置
            const toastCount = toastContainer.children.length;
            toast.style.top = `${toastCount * 60}px`; // 60px是每个toast的高度加上间距
            
            // 添加到toast容器中
            toastContainer.appendChild(toast);
            
            // 显示Toast
            setTimeout(() => {
                toast.style.transform = 'translateX(0)';
            }, 10);
            
            // 3秒后隐藏并移除元素
            setTimeout(() => {
                toast.style.transform = 'translateX(400px)';
                // 等待动画结束后移除元素
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                        // 如果容器为空，移除容器
                        if (toastContainer.children.length === 0) {
                            toastContainer.parentNode.removeChild(toastContainer);
                        }
                    }
                }, 300);
            }, 3000);
        }
        
        // 自定义确认弹框相关变量
        let confirmCallback = null;
        let confirmTitle = '';
        let confirmMessage = '';
        
        // 显示确认弹框
        function showConfirmModal(title, message, callback) {
            const modal = document.getElementById('confirmModal');
            const titleEl = document.getElementById('confirmTitle');
            const messageEl = document.getElementById('confirmMessage');
            
            // 检查元素是否存在
            if (!modal || !titleEl || !messageEl) return;
            
            confirmTitle = title;
            confirmMessage = message;
            confirmCallback = callback;
            
            titleEl.textContent = title;
            messageEl.textContent = message;
            messageEl.innerHTML = message.replace(/\n/g, '<br>');
            
            modal.classList.add('show');
        }
        
        // 关闭确认弹框
        function closeConfirmModal() {
            const modal = document.getElementById('confirmModal');
            if (modal) {
                modal.classList.remove('show');
            }
            confirmCallback = null;
        }
        
        // 确认操作
        function confirmAction() {
            if (confirmCallback) {
                const callback = confirmCallback;
                closeConfirmModal();
                callback();
            } else {
                closeConfirmModal();
            }
        }

        // 保存数据到localStorage
        function saveData() {
            localStorage.setItem('commandGeneratorVariables', JSON.stringify(variables));
            localStorage.setItem('commandGeneratorVariableOrder', JSON.stringify(variableOrder));
            localStorage.setItem('commandGeneratorCommands', JSON.stringify(commands));
            localStorage.setItem('commandGeneratorColumns', JSON.stringify(columns));
            // 如果有数据保存，清除清除数据标志
            if (Object.keys(variables).length > 0 || commands.length > 0 || columns.length > 0) {
                localStorage.removeItem('commandGeneratorHasClearedData');
            }
        }

        // 存储变量值
        let variables = loadData().variables;

        // 变量排序顺序
        let variableOrder = loadData().variableOrder;

        // 命令模板
        let commands = loadData().commands;

        // 分栏数据
        let columns = loadData().columns;

        // 当前编辑的命令索引
        let currentEditIndex = -1;
        
        // 当前编辑的分栏索引
        let currentEditColumnIndex = -1;
        
        // 活跃标签筛选
        let activeTags = [];
        
        // 活跃分栏ID
        let activeColumnId = null;
        
        // 搜索关键词
        let searchKeyword = '';

        // 当前语言 - 已在顶部声明

        // 语言管理模块
        const i18n = {
            // 语言数据结构，包含中英文翻译
            languages: {
                zh: {
                    name: "中文",
                    code: "zh",
                    translations: {
                        // 管理面板
                        '管理面板': '管理面板',
                        '命令管理': '命令管理',
                        '参数管理': '参数管理',
                        '分栏管理': '分栏管理',
                        '数据管理': '数据管理',
                        '添加新命令': '添加新命令',
                        '命令标题': '命令标题',
                        '命令描述（可选）': '命令描述（可选）',
                        '选择或输入标签': '选择或输入标签',
                        '所属分栏': '所属分栏',
                        '无分栏': '无分栏',
                        '命令模板': '命令模板',
                        '命令模板（使用${{变量名}}的形式引用变量）': '命令模板（使用${{变量名}}的形式引用变量）',
                        '添加命令': '添加命令',
                        '现有命令': '现有命令',
                        '搜索命令（标题、描述或模板）': '搜索命令（标题、描述或模板）',
                        '所有分栏': '所有分栏',
                        '添加新变量': '添加新变量',
                        '变量名': '变量名',
                        '添加变量': '添加变量',
                        '现有变量': '现有变量',
                        '添加新分栏': '添加新分栏',
                        '分栏名称': '分栏名称',
                        '添加分栏': '添加分栏',
                        '现有分栏': '现有分栏',
                        '数据导出': '数据导出',
                        '将当前所有数据导出为JSON文件，用于备份或迁移。': '将当前所有数据导出为JSON文件，用于备份或迁移。',
                        '导出数据': '导出数据',
                        '数据导入': '数据导入',
                        '从JSON文件导入数据，可以选择全新导入或增量导入。': '从JSON文件导入数据，可以选择全新导入或增量导入。',
                        '选择文件': '选择文件',
                        '未选择文件': '未选择文件',
                        '全新导入（覆盖现有数据）': '全新导入（覆盖现有数据）',
                        '增量导入（合并现有数据）': '增量导入（合并现有数据）',
                        '导入数据': '导入数据',
                        '清除数据': '清除数据',
                        '警告：此操作将永久删除所有数据，包括命令和变量，请谨慎操作！': '警告：此操作将永久删除所有数据，包括命令和变量，请谨慎操作！',
                        '清除所有数据': '清除所有数据',
                        '语言设置': '语言设置',
                        '中文': '中文',
                        'English': 'English',
                        '注意：语言切换仅影响系统固定内容，用户添加的命令和变量不受影响。': '注意：语言切换仅影响系统固定内容，用户添加的命令和变量不受影响。',
                        
                        // 主页面
                        '命令列表': '命令列表',
                        '搜索': '搜索',
                        '搜索命令或描述...': '搜索命令或描述...',
                        '标签筛选': '标签筛选',
                        '选择标签': '选择标签',
                        '清除': '清除',
                        '变量列表': '变量列表',
                        
                        // 模态框
                        '编辑命令': '编辑命令',
                        '取消': '取消',
                        '保存': '保存',
                        '确认操作': '确认操作',
                        '确定要执行此操作吗？': '确定要执行此操作吗？',
                        '确认': '确认',
                        '编辑分栏': '编辑分栏',
                        
                        // 其他
                        '✓ 点击退出': '✓ 点击退出',
                        '☰ 拖动排序': '☰ 拖动排序',
                        '已复制': '已复制',
                        '复制': '复制',
                        '命令已复制到剪贴板': '命令已复制到剪贴板',
                        '编辑': '编辑',
                        '删除': '删除',
                        '请输入变量名': '请输入变量名',
                        '变量名已存在': '变量名已存在',
                        '请输入命令标题': '请输入命令标题',
                        '请输入命令模板': '请输入命令模板',
                        '请输入分栏名称': '请输入分栏名称',
                        '分栏名称已存在': '分栏名称已存在',
                        '分栏删除成功': '分栏删除成功',
                        '命令删除成功': '命令删除成功',
                        '变量删除成功': '变量删除成功',
                        '数据导出成功': '数据导出成功',
                        '数据导入成功': '数据导入成功',
                        '数据清除成功': '数据清除成功',
                        '排序保存成功': '排序保存成功',
                        '语言切换成功': '语言切换成功',
                        '警告：删除所有数据': '警告：删除所有数据',
                        '此操作将永久删除所有数据，包括所有命令、变量和分栏！\n\n您确定要继续吗？': '此操作将永久删除所有数据，包括所有命令、变量和分栏！\n\n您确定要继续吗？',
                        '再次确认删除': '再次确认删除',
                        '请再次确认：此操作不可恢复，所有数据将被永久删除！': '请再次确认：此操作不可恢复，所有数据将被永久删除！',
                        '所有数据已清除': '所有数据已清除',
                        '确认删除分栏': '确认删除分栏',
                        '确定要删除分栏 "%s" 吗？该分栏下的命令将恢复为未分配状态。': '确定要删除分栏 "%s" 吗？该分栏下的命令将恢复为未分配状态。'
                    }
                },
                en: {
                    name: "English",
                    code: "en",
                    translations: {
                        // 管理面板
                        '管理面板': 'Management Panel',
                        '命令管理': 'Command Management',
                        '参数管理': 'Variable Management',
                        '分栏管理': 'Column Management',
                        '数据管理': 'Data Management',
                        '添加新命令': 'Add New Command',
                        '命令标题': 'Command Title',
                        '命令描述（可选）': 'Command Description (Optional)',
                        '选择或输入标签': 'Select or Enter Tags',
                        '所属分栏': 'Column',
                        '无分栏': 'No Column',
                        '命令模板': 'Command Template',
                        '命令模板（使用${{变量名}}的形式引用变量）': 'Command Template (Use ${{variable}} format to reference variables)',
                        '添加命令': 'Add Command',
                        '现有命令': 'Existing Commands',
                        '搜索命令（标题、描述或模板）': 'Search Commands (Title, Description, or Template)',
                        '所有分栏': 'All Columns',
                        '添加新变量': 'Add New Variable',
                        '变量名': 'Variable Name',
                        '添加变量': 'Add Variable',
                        '现有变量': 'Existing Variables',
                        '添加新分栏': 'Add New Column',
                        '分栏名称': 'Column Name',
                        '添加分栏': 'Add Column',
                        '现有分栏': 'Existing Columns',
                        '数据导出': 'Data Export',
                        '将当前所有数据导出为JSON文件，用于备份或迁移。': 'Export all current data as JSON file for backup or migration.',
                        '导出数据': 'Export Data',
                        '数据导入': 'Data Import',
                        '从JSON文件导入数据，可以选择全新导入或增量导入。': 'Import data from JSON file, you can choose full import or incremental import.',
                        '选择文件': 'Select File',
                        '未选择文件': 'No File Selected',
                        '全新导入（覆盖现有数据）': 'Full Import (Overwrite Existing Data)',
                        '增量导入（合并现有数据）': 'Incremental Import (Merge with Existing Data)',
                        '导入数据': 'Import Data',
                        '清除数据': 'Clear Data',
                        '警告：此操作将永久删除所有数据，包括命令和变量，请谨慎操作！': 'Warning: This operation will permanently delete all data, including commands and variables, please proceed with caution!',
                        '清除所有数据': 'Clear All Data',
                        '语言设置': 'Language Settings',
                        '中文': '中文',
                        'English': 'English',
                        '注意：语言切换仅影响系统固定内容，用户添加的命令和变量不受影响。': 'Note: Language switching only affects system fixed content, user-added commands and variables are not affected.',
                        
                        // 主页面
                        '主页面': 'Main Page',
                        '命令列表': 'Command List',
                        '搜索': 'Search',
                        '搜索命令或描述...': 'Search commands or description...',
                        '标签筛选': 'Tag Filter',
                        '选择标签': 'Select Tags',
                        '清除': 'Clear',
                        '变量列表': 'Variable List',
                        
                        // 模态框
                        '编辑命令': 'Edit Command',
                        '取消': 'Cancel',
                        '保存': 'Save',
                        '确认操作': 'Confirm Operation',
                        '确定要执行此操作吗？': 'Are you sure you want to perform this operation?',
                        '确认': 'Confirm',
                        '编辑分栏': 'Edit Column',
                        
                        // 其他
                        '✓ 点击退出': '✓ Click to Exit',
                        '☰ 拖动排序': '☰ Drag to Sort',
                        '已复制': 'Copied',
                        '复制': 'Copy',
                        '命令已复制到剪贴板': 'Command copied to clipboard',
                        '编辑': 'Edit',
                        '删除': 'Delete',
                        '已退出排序模式': 'Exited sort mode',
                        '进入排序模式，拖动项目调整顺序（自动保存）': 'Entered sort mode, drag items to adjust order (auto-save)',
                        '请输入变量名': 'Please enter variable name',
                        '变量名已存在': 'Variable name already exists',
                        '请输入命令标题': 'Please enter command title',
                        '请输入命令模板': 'Please enter command template',
                        '请输入分栏名称': 'Please enter column name',
                        '分栏名称已存在': 'Column name already exists',
                        '分栏删除成功': 'Column deleted successfully',
                        '命令删除成功': 'Command deleted successfully',
                        '变量删除成功': 'Variable deleted successfully',
                        '数据导出成功': 'Data exported successfully',
                        '数据导入成功': 'Data imported successfully',
                        '数据清除成功': 'Data cleared successfully',
                        '排序保存成功': 'Sorting saved successfully',
                        '语言切换成功': 'Language switched successfully',
                        '变量添加成功': 'Variable added successfully',
                        '请选择要导入的JSON文件': 'Please select a JSON file to import',
                        '复制失败，请重试': 'Copy failed, please try again',
                        '初始化失败，请刷新页面重试': 'Initialization failed, please refresh the page and try again',
                        '请检查输入信息': 'Please check input information',
                        '分栏添加成功': 'Column added successfully',
                        '分栏编辑成功': 'Column edited successfully',
                        '命令添加成功': 'Command added successfully',
                        '，已自动添加新变量': ', new variables have been automatically added',
                        '复制': 'Copy',
                        '命令已复制到剪贴板': 'Command copied to clipboard',
                        '警告：删除所有数据': 'Warning: Delete All Data',
                        '此操作将永久删除所有数据，包括所有命令、变量和分栏！\n\n您确定要继续吗？': 'This operation will permanently delete all data, including all commands, variables, and columns!\n\nAre you sure you want to continue?',
                        '再次确认删除': 'Confirm Deletion Again',
                        '请再次确认：此操作不可恢复，所有数据将被永久删除！': 'Please confirm again: This operation is irreversible, all data will be permanently deleted!',
                        '所有数据已清除': 'All data has been cleared',
                        '确认删除分栏': 'Confirm Delete Column',
                        '确定要删除分栏 "%s" 吗？该分栏下的命令将恢复为未分配状态。': 'Are you sure you want to delete the column "%s"? Commands under this column will be restored to unassigned status.'
                    }
                }
            },
            
            // 获取翻译文本
            t(key) {
                if (!this.languages[currentLanguage] || !this.languages[currentLanguage].translations) {
                    return key;
                }
                return this.languages[currentLanguage].translations[key] || key;
            },
            
            // 获取当前语言的所有翻译
            getTranslations() {
                if (!this.languages[currentLanguage]) {
                    return {};
                }
                return this.languages[currentLanguage].translations || {};
            }
        };

        // 语言切换函数
        function changeLanguage(lang) {
            try {
                // 更新当前语言
                currentLanguage = lang;
                
                // 保存语言设置到localStorage
                localStorage.setItem('commandGeneratorLanguage', lang);
                
                // 更新语言按钮状态
                const langZh = document.getElementById('lang-zh');
                const langEn = document.getElementById('lang-en');
                if (langZh) {
                    langZh.style.backgroundColor = lang === 'zh' ? 'white' : 'transparent';
                    langZh.style.color = lang === 'zh' ? 'var(--primary-color)' : 'rgba(255, 255, 255, 0.5)';
                }
                if (langEn) {
                    langEn.style.backgroundColor = lang === 'en' ? 'white' : 'transparent';
                    langEn.style.color = lang === 'en' ? 'var(--primary-color)' : 'rgba(255, 255, 255, 0.5)';
                }
                
                // 更新所有固定内容的文本
                updateLanguageContent();
                
                // 显示语言切换成功提示
                showToast(i18n.t('语言切换成功'), 'success');
            } catch (error) {
                console.error('Error in changeLanguage:', error);
            }
        }
        
        // 更新语言内容
        function updateLanguageContent() {
            try {
                // 获取当前语言的翻译
                const translations = i18n.getTranslations();
                
                // 获取所有需要翻译的元素 - 包括特定的div元素（如子菜单和tab项）
                const elements = document.querySelectorAll('[data-lang-key], h2, h3, h4, label, span, button, p, option, .sub-tab-item, .tab-item, .modal-title, .modal-body p');
                
                // 处理特殊的tab项（主页面和管理面板）
                const mainTab = document.querySelector('.tab-item[data-tab="main"]');
                const managementTab = document.querySelector('.tab-item[data-tab="management"]');
                
                if (mainTab) {
                    mainTab.textContent = i18n.t('主页面');
                }
                
                if (managementTab) {
                    managementTab.textContent = i18n.t('管理面板');
                }
                
                elements.forEach(element => {
                    // 处理placeholder属性的翻译
                    if (element.hasAttribute('placeholder')) {
                        const placeholder = element.getAttribute('placeholder');
                        if (placeholder) {
                            let translationKey = placeholder;
                            
                            // 如果直接查找失败，尝试反向查找键（用于从英文切换回中文的情况）
                            if (!translations[translationKey]) {
                                // 遍历英文翻译，查找对应的中文键
                                const enTranslations = i18n.languages['en'].translations;
                                const zhTranslations = i18n.languages['zh'].translations;
                                for (const zhKey in zhTranslations) {
                                    if (enTranslations[zhKey] === translationKey) {
                                        translationKey = zhKey;
                                        break;
                                    }
                                }
                            }
                            
                            // 使用找到的键获取翻译
                            if (translations[translationKey]) {
                                element.setAttribute('placeholder', translations[translationKey]);
                            }
                        }
                    }
                    
                    // 跳过空元素或没有文本内容的元素
                    if (!element || !element.textContent || element.textContent.trim() === '') return;
                    
                    // 跳过用户添加的内容（如命令标题、描述或模板）
                    if (element.id && (element.id.includes('CmdTitle') || element.id.includes('CmdDescription') || element.id.includes('CmdTemplate') || element.id.includes('VarName'))) {
                        return;
                    }
                    
                    // 处理包含radio按钮的label元素，只更新文本内容而不破坏radio按钮
                    if (element.tagName === 'LABEL' && element.querySelector('input[type="radio"]')) {
                        // 获取radio按钮
                        const radio = element.querySelector('input[type="radio"]');
                        // 获取当前文本内容（不包含radio按钮）
                        const currentText = element.textContent.trim();
                        
                        // 尝试使用当前文本作为键获取翻译
                        let translationKey = currentText;
                        
                        // 如果直接查找失败，尝试反向查找键（用于从英文切换回中文的情况）
                        if (!translations[translationKey]) {
                            // 遍历英文翻译，查找对应的中文键
                            const enTranslations = i18n.languages['en'].translations;
                            const zhTranslations = i18n.languages['zh'].translations;
                            for (const zhKey in zhTranslations) {
                                if (enTranslations[zhKey] === translationKey) {
                                    translationKey = zhKey;
                                    break;
                                }
                            }
                        }
                        
                        // 使用找到的键获取翻译
                        if (translations[translationKey]) {
                            // 移除radio按钮
                            radio.remove();
                            // 更新文本内容
                            element.textContent = translations[translationKey];
                            // 重新添加radio按钮到label开头
                            element.insertBefore(radio, element.firstChild);
                        }
                        return;
                    }
                    
                    // 如果元素有data-lang-key属性，直接使用该键获取翻译
                    if (element.dataset && element.dataset.langKey) {
                        const key = element.dataset.langKey;
                        if (translations[key]) {
                            element.textContent = translations[key];
                        }
                    } 
                    // 否则，尝试使用元素的当前文本作为键获取翻译
                    else {
                        const currentText = element.textContent.trim();
                        let translationKey = currentText;
                        
                        // 如果直接查找失败，尝试反向查找键（用于从英文切换回中文的情况）
                        if (!translations[translationKey]) {
                            // 遍历英文翻译，查找对应的中文键
                            const enTranslations = i18n.languages['en'].translations;
                            const zhTranslations = i18n.languages['zh'].translations;
                            for (const zhKey in zhTranslations) {
                                if (enTranslations[zhKey] === translationKey) {
                                    translationKey = zhKey;
                                    break;
                                }
                            }
                        }
                        
                        // 使用找到的键获取翻译
                        if (translations[translationKey]) {
                            element.textContent = translations[translationKey];
                        }
                    }
                });
                
                // 更新输入框的placeholder
                const inputs = document.querySelectorAll('input[type="text"], textarea, select');
                inputs.forEach(input => {
                    if (!input) return;
                    
                    if (input.placeholder) {
                        const placeholder = input.placeholder.trim();
                        let translationKey = placeholder;
                        
                        // 如果直接查找失败，尝试反向查找键
                        if (!translations[translationKey]) {
                            // 遍历英文翻译，查找对应的中文键
                            const enTranslations = i18n.languages['en'].translations;
                            const zhTranslations = i18n.languages['zh'].translations;
                            for (const zhKey in zhTranslations) {
                                if (enTranslations[zhKey] === translationKey) {
                                    translationKey = zhKey;
                                    break;
                                }
                            }
                        }
                        
                        // 使用找到的键获取翻译
                        if (translations[translationKey]) {
                            input.placeholder = translations[translationKey];
                        }
                    }
                });
                
                // 更新复制按钮文本
                const copyButtons = document.querySelectorAll('.copy-btn');
                copyButtons.forEach(btn => {
                    if (!btn) return;
                    btn.textContent = i18n.t('复制');
                });
                
                // 更新编辑和删除按钮文本
                const editButtons = document.querySelectorAll('.edit-btn');
                editButtons.forEach(btn => {
                    if (!btn) return;
                    btn.textContent = i18n.t('编辑');
                });
                
                const deleteButtons = document.querySelectorAll('.delete-btn');
                deleteButtons.forEach(btn => {
                    if (!btn) return;
                    btn.textContent = i18n.t('删除');
                });
                
                // 更新取消和保存按钮文本
                const cancelButtons = document.querySelectorAll('.cancel-btn');
                cancelButtons.forEach(btn => {
                    if (!btn) return;
                    btn.textContent = i18n.t('取消');
                });
                
                const saveButtons = document.querySelectorAll('.save-btn');
                saveButtons.forEach(btn => {
                    if (!btn) return;
                    if (btn.textContent.trim() === '保存') {
                        btn.textContent = i18n.t('保存');
                    }
                });
                
                // 更新模态框标题和按钮
                const modalTitles = document.querySelectorAll('.modal-title');
                modalTitles.forEach(title => {
                    if (!title) return;
                    const currentText = title.textContent.trim();
                    let translationKey = currentText;
                    
                    // 如果直接查找失败，尝试反向查找键
                    if (!translations[translationKey]) {
                        const enTranslations = i18n.languages['en'].translations;
                        const zhTranslations = i18n.languages['zh'].translations;
                        for (const zhKey in zhTranslations) {
                            if (enTranslations[zhKey] === translationKey) {
                                translationKey = zhKey;
                                break;
                            }
                        }
                    }
                    
                    if (translations[translationKey]) {
                        title.textContent = translations[translationKey];
                    }
                });
                
                // 更新确认弹框的默认文本
                const confirmTitle = document.getElementById('confirmTitle');
                const confirmMessage = document.getElementById('confirmMessage');
                if (confirmTitle) {
                    confirmTitle.textContent = i18n.t('确认操作');
                }
                if (confirmMessage) {
                    confirmMessage.textContent = i18n.t('确定要执行此操作吗？');
                }
            } catch (error) {
                console.error('Error in updateLanguageContent:', error);
            }
        }
        
        // 自动退出排序模式
        function autoExitSortMode() {
            if (activeSortListType) {
                // 移除所有列表的排序模式
                const listElements = document.querySelectorAll(`[data-list-type="${activeSortListType}"]`);
                listElements.forEach(el => {
                    el.draggable = false;
                    el.style.cursor = '';
                });
                
                // 更新排序按钮状态
                const currentSortButtons = document.querySelectorAll(`button[data-sort-type="${activeSortListType}"]`);
                currentSortButtons.forEach(btn => {
                    btn.style.backgroundColor = 'var(--primary-color)';
                    btn.textContent = i18n.t('☰ 拖动排序');
                });
                
                // 关闭排序模式
                activeSortListType = null;
            }
        }
        
        // 二级导航切换功能
        function initSubTabSystem() {
            // 移除所有现有的事件监听器，避免重复绑定
            document.querySelectorAll('.sub-tab-item').forEach(item => {
                item.onclick = null;
            });
            
            const subTabItems = document.querySelectorAll('.sub-tab-item');
            
            subTabItems.forEach(item => {
                item.addEventListener('click', () => {
                    // 自动退出排序模式
                    autoExitSortMode();
                    
                    // 移除所有active类
                    subTabItems.forEach(i => {
                        i.classList.remove('active');
                        i.style.color = 'var(--text-secondary)';
                        i.style.borderBottom = 'none';
                    });
                    document.querySelectorAll('.sub-tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    // 添加当前subTab的active类
                    item.classList.add('active');
                    item.style.color = 'var(--primary-color)';
                    item.style.borderBottom = '2px solid var(--primary-color)';
                    
                    const subTabId = item.dataset.subtab;
                    document.getElementById(`management-${subTabId}`).classList.add('active');
                    
                    // 根据切换的子标签更新相应的列表
                    if (subTabId === 'command-management') {
                        updateCommandManagementList();
                    } else if (subTabId === 'variable-management') {
                        updateVariableManagementList();
                    } else if (subTabId === 'column-management') {
                        updateColumnsList();
                    } else if (subTabId === 'data-management') {
                        // 数据管理不需要特殊更新，直接显示即可
                    }
                    
                    // 更新语言内容，确保按钮文本正确
                    updateLanguageContent();
                });
            });
        }

        // Tab切换功能
        function initTabSystem() {
            const tabItems = document.querySelectorAll('.tab-item');
            
            tabItems.forEach(item => {
                item.addEventListener('click', () => {
                    // 自动退出排序模式
                    autoExitSortMode();
                    
                    // 移除所有active类和management-active类
                    tabItems.forEach(i => {
                        i.classList.remove('active');
                        i.classList.remove('management-active');
                    });
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    const tabId = item.dataset.tab;
                    
                    // 根据标签类型添加不同的激活类
                    if (tabId === 'management') {
                        // 管理面板使用management-active类（无上浮效果）
                        item.classList.add('management-active');
                    } else {
                        // 其他标签使用active类（有上浮效果）
                        item.classList.add('active');
                    }
                    
                    // 检查是否是分栏菜单项
                    if (tabId.startsWith('column_')) {
                        // 分栏菜单项：显示主页面，并筛选该分栏下的命令和变量
                        document.getElementById('main').classList.add('active');
                        
                        // 更新活跃分栏ID（移除'column_'前缀）
                        activeColumnId = tabId.replace('column_', '');
                        
                        // 更新命令列表和变量列表
                        updateCommands();
                        updateVariablesList();
                    } else {
                        // 普通菜单项：直接显示对应的内容
                        document.getElementById(tabId).classList.add('active');
                        
                        // 重置活跃分栏ID
                        activeColumnId = null;
                        
                        // 根据切换的标签更新相应的列表
                        if (tabId === 'management') {
                            // 切换到管理面板时，初始化二级导航
                            initSubTabSystem();
                            updateCommandManagementList();
                            updateVariableManagementList();
                        } else if (tabId === 'main') {
                            // 切换到主页面时，更新变量列表和命令列表
                            updateVariablesList();
                            updateCommands();
                        }
                    }
                });
            });
        }

        // 从命令模板中提取所有变量名 - 使用${{变量名}}格式
        function extractVariablesFromCommands() {
            const variablesSet = new Set();
            
            // 筛选当前显示的命令，使用与updateCommands相同的筛选逻辑
            const filteredCommands = commands.filter(command => {
                let showCommand = true;
                
                // 1. 分栏筛选
                if (activeColumnId) {
                    if (command.columnId !== activeColumnId) {
                        showCommand = false;
                    }
                }
                
                // 2. 标签筛选
                if (showCommand && activeTags.length > 0) {
                    const hasMatchingTag = command.tags.some(tag => activeTags.includes(tag));
                    if (!hasMatchingTag) {
                        showCommand = false;
                    }
                }
                
                // 3. 搜索筛选
                if (showCommand && searchKeyword) {
                    const searchableText = `${command.title} ${command.description || ''} ${command.template}`.toLowerCase();
                    if (!searchableText.includes(searchKeyword)) {
                        showCommand = false;
                    }
                }
                
                return showCommand;
            });
            
            filteredCommands.forEach(command => {
                // 使用正确的正则表达式匹配变量格式
                const matches = command.template.match(/\$\{\{([A-Za-z0-9_]+)\}\}/g) || [];
                matches.forEach(match => {
                    // 去掉${{和}}符号，并转换为大写
                    const varName = match.substring(3, match.length - 2).toUpperCase();
                    variablesSet.add(varName);
                });
            });
            
            // 获取所有使用的变量
            const usedVariables = Array.from(variablesSet);
            
            // 按照variableOrder排序，不在排序列表中的变量放在后面
            const sortedVariables = [...usedVariables].sort((a, b) => {
                const indexA = variableOrder.indexOf(a);
                const indexB = variableOrder.indexOf(b);
                
                // 都在排序列表中，按列表顺序
                if (indexA !== -1 && indexB !== -1) {
                    return indexA - indexB;
                }
                // 只有a在排序列表中，a在前
                if (indexA !== -1) {
                    return -1;
                }
                // 只有b在排序列表中，b在前
                if (indexB !== -1) {
                    return 1;
                }
                // 都不在排序列表中，按字母顺序
                return a.localeCompare(b);
            });
            
            return sortedVariables;
        }
        
        // 提取所有唯一标签
        function getAllUniqueTags() {
            const tagsSet = new Set();
            
            commands.forEach(command => {
                if (command.tags && command.tags.length > 0) {
                    command.tags.forEach(tag => {
                        tagsSet.add(tag);
                    });
                }
            });
            
            return Array.from(tagsSet).sort();
        }
        
        // 更新自定义标签筛选下拉框
        function updateCustomTagFilter() {
            const tagFilterContainer = document.getElementById('tagFilterContainer');
            const tagFilterOptions = document.getElementById('tagFilterOptions');
            const allTags = getAllUniqueTags();
            
            // 清空选项
            tagFilterOptions.innerHTML = '';
            
            // 添加所有标签选项
            allTags.forEach(tag => {
                const option = document.createElement('div');
                option.style.padding = '0.5rem';
                option.style.cursor = 'pointer';
                option.style.display = 'flex';
                option.style.alignItems = 'center';
                option.style.gap = '0.5rem';
                option.style.transition = 'background-color 0.2s';
                option.onmouseenter = () => option.style.backgroundColor = '#f0f2f5';
                option.onmouseleave = () => option.style.backgroundColor = '';
                
                // 复选框
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = `tag_${tag}`;
                checkbox.checked = activeTags.includes(tag);
                checkbox.style.margin = '0';
                
                // 标签文本（不再使用label，避免事件冲突）
                const tagText = document.createElement('span');
                tagText.textContent = tag;
                tagText.style.flex = '1';
                tagText.style.cursor = 'pointer';
                
                // 点击整个条目切换复选框状态
                const toggleCheckbox = () => {
                    // 切换复选框状态
                    checkbox.checked = !checkbox.checked;
                    // 更新activeTags数组
                    if (checkbox.checked) {
                        if (!activeTags.includes(tag)) {
                            activeTags.push(tag);
                        }
                    } else {
                        activeTags = activeTags.filter(t => t !== tag);
                    }
                    // 更新显示
                    updateSelectedTagsDisplay();
                    updateCommands();
                };
                
                // 点击整个选项时切换状态
                option.addEventListener('click', (e) => {
                    // 切换复选框状态
                    toggleCheckbox();
                    // 阻止事件冒泡，避免触发容器的点击事件
                    e.stopPropagation();
                });
                
                // 点击文本时也切换状态
                tagText.addEventListener('click', (e) => {
                    toggleCheckbox();
                    // 阻止事件冒泡
                    e.stopPropagation();
                });
                
                // 点击复选框时也切换状态
                checkbox.addEventListener('click', (e) => {
                    // 阻止事件冒泡到option，避免重复触发
                    e.stopPropagation();
                    // 更新activeTags数组
                    if (checkbox.checked) {
                        if (!activeTags.includes(tag)) {
                            activeTags.push(tag);
                        }
                    } else {
                        activeTags = activeTags.filter(t => t !== tag);
                    }
                    // 更新显示
                    updateSelectedTagsDisplay();
                    updateCommands();
                });
                
                option.appendChild(checkbox);
                option.appendChild(tagText);
                tagFilterOptions.appendChild(option);
            });
            
            // 更新选中标签显示
            updateSelectedTagsDisplay();
        }
        
        // 更新选中标签的显示
        function updateSelectedTagsDisplay() {
            const container = document.getElementById('tagFilterContainer');
            const placeholder = document.getElementById('tagFilterPlaceholder');
            
            // 检查容器和占位符是否存在
            if (!container || !placeholder) return;
            
            // 移除所有已选中的标签
            const existingTags = container.querySelectorAll('.selected-tag');
            existingTags.forEach(tag => tag.remove());
            
            // 如果有选中的标签，隐藏占位符并显示标签
            if (activeTags.length > 0) {
                placeholder.style.display = 'none';
                
                activeTags.forEach(tag => {
                    const tagElement = document.createElement('span');
                    tagElement.className = 'selected-tag';

                    
                    // 标签文本
                    const tagText = document.createTextNode(tag);
                    tagElement.appendChild(tagText);
                    
                    // 删除按钮
                    const deleteBtn = document.createElement('span');
                    deleteBtn.textContent = '×';
                    deleteBtn.style.fontSize = '1rem';
                    deleteBtn.style.cursor = 'pointer';
                    deleteBtn.style.marginLeft = '0.2rem';
                    deleteBtn.onclick = (e) => {
                        e.stopPropagation();
                        activeTags = activeTags.filter(t => t !== tag);
                        updateCustomTagFilter();
                        updateCommands();
                    };
                    
                    tagElement.appendChild(deleteBtn);
                    container.appendChild(tagElement);
                });
            } else {
                // 没有选中的标签，显示占位符
                placeholder.style.display = 'inline';
            }
        }

        // 初始化搜索功能
        function initSearch() {
            const searchInput = document.getElementById('searchInput');
            const tagFilterContainer = document.getElementById('tagFilterContainer');
            const tagFilterOptions = document.getElementById('tagFilterOptions');
            const clearTagsBtn = document.getElementById('clearTagsBtn');
            let isDropdownOpen = false;
            
            // 搜索输入事件
            if (searchInput) {
                searchInput.addEventListener('input', (e) => {
                    searchKeyword = e.target.value.toLowerCase().trim();
                    updateCommands();
                });
            }
            
            // 切换下拉框显示
            if (tagFilterContainer && tagFilterOptions) {
                tagFilterContainer.addEventListener('click', () => {
                    isDropdownOpen = !isDropdownOpen;
                    tagFilterOptions.style.display = isDropdownOpen ? 'block' : 'none';
                });
                
                // 点击页面其他地方关闭下拉框
                document.addEventListener('click', (e) => {
                    if (tagFilterContainer && tagFilterOptions && !tagFilterContainer.contains(e.target) && !tagFilterOptions.contains(e.target)) {
                        isDropdownOpen = false;
                        tagFilterOptions.style.display = 'none';
                    }
                });
            }
            
            // 清除标签筛选按钮点击事件
            if (clearTagsBtn) {
                clearTagsBtn.addEventListener('click', () => {
                    activeTags = [];
                    updateCustomTagFilter();
                    updateCommands();
                });
            }
        }
        
        // 自动添加命令中的新变量到变量管理
        function autoAddVariablesFromCommand(commandTemplate) {
            const matches = commandTemplate.match(/\$\{\{([A-Za-z0-9_]+)\}\}/g) || [];
            let hasNewVariable = false;
            
            matches.forEach(match => {
                // 去掉${{和}}符号，并转换为大写
                const varName = match.substring(3, match.length - 2).toUpperCase();
                if (!variables[varName]) {
                    variables[varName] = ''; // 初始值为空字符串
                    hasNewVariable = true;
                }
            });
            
            return hasNewVariable;
        }

        // 更新变量列表 - 显示所有命令中使用的变量（主页面只有编辑功能，没有删除按钮）
        function updateVariablesList() {
            const variablesList = document.getElementById('variablesList');
            if (!variablesList) return;
            
            const allVariables = extractVariablesFromCommands();
            const isSorting = activeSortListType === 'variables';
            
            variablesList.innerHTML = '';
            
            // 添加排序按钮
            const sortContainer = document.createElement('div');
            sortContainer.style.cssText = 'display: flex; justify-content: flex-end; margin-bottom: 1rem;';
            
            const exitText = i18n.t('✓ 点击退出');
            const sortText = i18n.t('☰ 拖动排序');
            const buttonText = isSorting ? exitText : sortText;
            
            sortContainer.innerHTML = `
                <button onclick="toggleSortMode('variables')" data-sort-type="variables" 
                        class="sort-btn ${isSorting ? 'active' : ''}">
                    <span>${isSorting ? i18n.t('✓ 点击退出') : i18n.t('☰ 拖动排序')}</span>
                </button>
            `;
            variablesList.appendChild(sortContainer);
            
            allVariables.forEach(varName => {
                const value = variables[varName] || `[${varName}_PLACEHOLDER]`;
                
                const variableItem = document.createElement('div');
                variableItem.className = 'variable-item';
                variableItem.dataset.listType = 'variables';
                variableItem.dataset.varName = varName;
                variableItem.dataset.index = allVariables.indexOf(varName);
                
                variableItem.innerHTML = `
                    <div class="variable-name">
                        <span style="cursor: move; margin-right: 0.5rem; opacity: 0.6;">☰</span>
                        ${varName}
                    </div>
                    <div class="variable-value" onclick="editVariable(this)">${value}</div>
                `;
                
                // 添加拖动事件监听器（如果当前处于排序模式）
                if (isSorting) {
                    variableItem.draggable = true;
                    variableItem.style.cursor = 'move';
                    variableItem.addEventListener('dragstart', handleDragStart);
                    variableItem.addEventListener('dragover', handleDragOver);
                    variableItem.addEventListener('drop', handleDrop);
                    variableItem.addEventListener('dragend', handleDragEnd);
                }
                
                variablesList.appendChild(variableItem);
            });
        }

        // 渲染标签列表
        function renderTags(tags) {
            if (!tags || tags.length === 0) {
                return '';
            }
            
            return `<div class="command-tags">
                ${tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
            </div>`;
        }

        // 更新分栏筛选器选项
        function updateColumnFilter() {
            const columnFilter = document.getElementById('management-columnFilter');
            if (!columnFilter) return;
            
            // 保存当前选中的值
            const currentValue = columnFilter.value;
            
            // 清空现有选项，添加默认选项（使用翻译）
            columnFilter.innerHTML = `<option value="">${i18n.t('所有分栏')}</option>`;
            
            // 添加分栏选项
            columns.forEach(column => {
                const option = document.createElement('option');
                option.value = column.id;
                option.textContent = column.name;
                columnFilter.appendChild(option);
            });
            
            // 恢复选中的值
            columnFilter.value = currentValue;
        }
        
        // 更新命令管理列表
        function updateCommandManagementList() {
            // 获取搜索关键词
            const searchInput = document.getElementById('management-commandSearch');
            const searchKeyword = searchInput ? searchInput.value.toLowerCase().trim() : '';
            
            // 获取分栏筛选值
            const columnFilter = document.getElementById('management-columnFilter');
            const selectedColumnId = columnFilter ? columnFilter.value : '';
            
            // 处理命令列表的函数
            function processCommandsList(listElement) {
                listElement.innerHTML = '';
                
                // 过滤命令
                const filteredCommands = commands.filter(command => {
                    // 搜索过滤
                    const matchesSearch = !searchKeyword || 
                        `${command.title} ${command.description || ''} ${command.template}`.toLowerCase().includes(searchKeyword);
                    
                    // 分栏过滤
                    const matchesColumn = !selectedColumnId || 
                        command.columnId === selectedColumnId;
                    
                    return matchesSearch && matchesColumn;
                });
                
                filteredCommands.forEach((command, index) => {
                    // 找到原始索引，用于编辑和删除操作
                    const originalIndex = commands.indexOf(command);
                    
                    const commandItem = document.createElement('div');
                    commandItem.className = 'command-item';
                    
                    let descriptionHtml = '';
                    if (command.description) {
                        descriptionHtml = `<div class="command-description">${command.description}</div>`;
                    }
                    
                    // 处理命令模板，支持---script---和---end---标记
                    let commandText = command.template;
                    let templateLines = [];
                    
                    // 解析命令文本，处理 ---script--- 和 ---end--- 标记
                    const lines = commandText.split('\n');
                    let inScriptBlock = false;
                    let currentBlock = [];
                    
                    lines.forEach(line => {
                        const trimmedLine = line.trim();
                        
                        if (trimmedLine === '---script---') {
                            // 开始脚本块
                            if (currentBlock.length > 0) {
                                // 保存之前的代码块
                                templateLines.push(currentBlock.join('\n').trim());
                                currentBlock = [];
                            }
                            inScriptBlock = true;
                        } else if (trimmedLine === '---end---') {
                            // 结束脚本块
                            if (currentBlock.length > 0) {
                                // 保存脚本块
                                templateLines.push(currentBlock.join('\n').trim());
                                currentBlock = [];
                            }
                            inScriptBlock = false;
                        } else if (inScriptBlock) {
                            // 在脚本块内，添加到当前块
                            currentBlock.push(line);
                        } else {
                            // 不在脚本块内，每行作为一个代码块
                            if (trimmedLine !== '') {
                                templateLines.push(line.trim());
                            }
                        }
                    });
                    
                    // 保存最后一个代码块
                    if (currentBlock.length > 0) {
                        templateLines.push(currentBlock.join('\n').trim());
                    }
                    
                    // 过滤空代码块
                    templateLines = templateLines.filter(line => line.trim() !== '');
                    
                    // 命令头和描述
                    const editText = i18n.t('编辑');
                    const deleteText = i18n.t('删除');
                    let commandHtml = `
                        <div class="command-header">
                            <h3 class="command-title">${command.title}</h3>
                            <div class="command-actions">
                                <button class="edit-btn" onclick="openEditModal(${originalIndex})"></button>
                                <button class="delete-btn" onclick="deleteCommand(${originalIndex})"></button>
                            </div>
                        </div>
                        ${descriptionHtml}
                        ${renderTags(command.tags)}
                    `;
                    
                    // 为每一个代码块创建一个代码块元素
                    templateLines.forEach((line, lineIndex) => {
                        // 将变量名转换为大写
                        let processedLine = line;
                        // 匹配${{variable}}格式的变量名
                        processedLine = processedLine.replace(/\$\{\{([A-Za-z0-9_]+)\}\}/g, (match, varName) => {
                            // 将变量名转换为大写
                            return `\${{${varName.toUpperCase()}}}`;
                        });
                        
                        commandHtml += `
                            <div class="code-block" style="margin-top: 1rem;">
                                <pre>${processedLine}</pre>
                            </div>
                        `;
                    });
                    
                    commandItem.innerHTML = commandHtml;
                    listElement.appendChild(commandItem);
                    
                    // 更新按钮文本
                    const editBtn = commandItem.querySelector('.edit-btn');
                    const deleteBtn = commandItem.querySelector('.delete-btn');
                    if (editBtn) editBtn.textContent = i18n.t('编辑');
                    if (deleteBtn) deleteBtn.textContent = i18n.t('删除');
                });
            }
            
            // 更新原命令管理页面的列表
            const commandsList = document.getElementById('commandManagementList');
            if (commandsList) {
                processCommandsList(commandsList);
            }
            
            // 更新管理面板中的命令列表
            const managementCommandsList = document.getElementById('management-commandManagementList');
            if (managementCommandsList) {
                processCommandsList(managementCommandsList);
            }
        }
        
        // 初始化管理面板搜索和筛选功能
        function initManagementSearch() {
            const searchInput = document.getElementById('management-commandSearch');
            const columnFilter = document.getElementById('management-columnFilter');
            
            // 搜索输入事件
            if (searchInput) {
                searchInput.addEventListener('input', () => {
                    updateCommandManagementList();
                });
            }
            
            // 分栏筛选事件
            if (columnFilter) {
                columnFilter.addEventListener('change', () => {
                    updateCommandManagementList();
                });
            }
        }

        // 更新变量管理列表
        function updateVariableManagementList() {
            // 处理变量列表的函数
            function processVariablesList(listElement) {
                listElement.innerHTML = '';
                
                // 添加变量项，按照variableOrder排序
                const sortedVariableNames = [...variableOrder].filter(name => variables.hasOwnProperty(name));
                
                sortedVariableNames.forEach(name => {
                    const value = variables[name];
                    const variableItem = document.createElement('div');
                    variableItem.className = 'variable-item';
                    
                    // 获取翻译文本
                    const deleteText = i18n.t('删除');
                    
                    variableItem.innerHTML = `
                        <div class="variable-name">${name}</div>
                        <div style="display: flex; align-items: center; gap: 0.75rem; margin-top: 0.5rem;">
                            <div class="variable-value" onclick="editVariable(this)" style="flex: 1;">${value}</div>
                            <button onclick="deleteVariable('${name}')" class="delete-btn" style="padding: 0.5rem 1rem; font-size: 0.875rem; font-weight: 500; border-radius: 6px; white-space: nowrap;">${deleteText}</button>
                        </div>
                    `;
                    variableItem.dataset.varName = name;
                    listElement.appendChild(variableItem);
                });
            }
            
            // 更新原变量管理页面的列表
            const variablesList = document.getElementById('variableManagementList');
            if (variablesList) {
                processVariablesList(variablesList);
            }
            
            // 更新管理面板中的变量列表
            const managementVariablesList = document.getElementById('management-variableManagementList');
            if (managementVariablesList) {
                processVariablesList(managementVariablesList);
            }
        }

        // 拖动排序相关函数
        let draggedElement = null;
        let draggedListType = ''; // 'commands', 'variables', or 'columns'
        let dragOverCounter = 0;
        
        // 开始拖动
        function handleDragStart(e) {
            draggedElement = this;
            draggedListType = this.dataset.listType;
            
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            
            // 设置拖动数据，确保可以正确处理拖动
            e.dataTransfer.setData('text/plain', '');
            
            // 重置计数器
            dragOverCounter = 0;
        }
        
        // 拖动经过
        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
            
            // 增加计数器
            dragOverCounter++;
            
            // 获取当前元素的父容器
            let container;
            if (this.classList.contains('variables-list') || this.classList.contains('commands-list') || this.classList.contains('columns-list')) {
                container = this;
            } else {
                container = this.parentNode;
            }
            
            // 获取插入位置
            const afterElement = getDragAfterElement(container, e.clientY);
            const draggable = document.querySelector('.dragging');
            
            // 移动元素，让用户能看到拖动效果
            if (afterElement == null) {
                container.appendChild(draggable);
            } else {
                container.insertBefore(draggable, afterElement);
            }
        }
        
        // 拖动离开
        function handleDragLeave(e) {
            e.preventDefault();
            
            // 减少计数器
            dragOverCounter--;
        }
        
        // 放置元素
        function handleDrop(e) {
            e.preventDefault();
            e.stopPropagation();
            
            // 重置计数器
            dragOverCounter = 0;
        }
        
        // 拖动结束
        function handleDragEnd(e) {
            // 移除拖动类
            this.classList.remove('dragging');
            
            // 直接处理排序，不依赖元素位置检测
            if (draggedListType === 'columns') {
                const container = document.getElementById('columnsList');
                // 获取所有command-item元素，这些元素已经按照拖动后的顺序排列
                const commandItems = Array.from(container.querySelectorAll('.command-item'));
                
                // 直接根据元素在容器中的顺序重新排列columns数组
                // 不需要复杂的名称匹配，直接获取元素的data-index属性
                const newColumns = commandItems.map(item => {
                    const index = parseInt(item.dataset.index);
                    return columns[index];
                }).filter(column => column);
                
                // 更新columns数组
                columns = newColumns;
                
                updateColumnsList();
                updateColumnSelectors();
                generateSidebarColumns();
            } else if (draggedListType === 'commands') {
                const container = document.getElementById('commandsList');
                Array.from(container.querySelectorAll('.command-item')).forEach((item, newIndex) => {
                    const index = parseInt(item.dataset.index);
                    if (!isNaN(index) && commands[index]) {
                        commands[index].sortOrder = newIndex;
                    }
                });
                updateCommandManagementList();
            } else if (draggedListType === 'variables') {
                const container = document.getElementById('variablesList');
                const newVariableOrder = Array.from(container.querySelectorAll('.variable-item'))
                    .map(item => item.dataset.varName)
                    .filter(varName => varName);
                
                // 确保所有变量都包含在新的排序中
                const allVariables = extractVariablesFromCommands();
                const remainingVariables = allVariables.filter(name => !newVariableOrder.includes(name));
                variableOrder = [...newVariableOrder, ...remainingVariables];
                updateVariableManagementList();
            }
            
            // 保存到localStorage并重置状态
            saveData();
            draggedElement = null;
            draggedListType = '';
        }
        
        // 获取拖动元素应该插入到哪个元素之后
        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('[draggable="true"]:not(.dragging)')];
            
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }
        
        // 保存排序结果（现在只是一个空函数，保持API兼容）
        function saveSortResult(listType) {
            // 拖动结束时已经保存了排序结果，这里不需要做任何事情
            // 保持这个函数是为了兼容现有的代码结构
        }
        
        // 当前激活的排序列表类型
        let activeSortListType = null;
        
        // 切换拖动排序模式
        function toggleSortMode(listType) {
            const isCurrentlyActive = activeSortListType === listType;
            const sortButtons = document.querySelectorAll(`button[data-sort-type="${listType}"]`);
            
            // 更新按钮状态的辅助函数
            const updateButtons = (buttons, isActive) => {
                buttons.forEach(btn => {
                    btn.style.backgroundColor = isActive ? 'var(--success-color)' : 'var(--primary-color)';
                    btn.textContent = isActive ? i18n.t('✓ 点击退出') : i18n.t('☰ 拖动排序');
                });
            };
            
            if (isCurrentlyActive) {
                // 退出排序模式
                activeSortListType = null;
                updateButtons(sortButtons, false);
                showToast(i18n.t('已退出排序模式'), 'success');
            } else {
                // 移除之前列表的排序模式
                if (activeSortListType) {
                    const previousSortButtons = document.querySelectorAll(`button[data-sort-type="${activeSortListType}"]`);
                    updateButtons(previousSortButtons, false);
                }
                
                // 进入当前列表的排序模式
                activeSortListType = listType;
                updateButtons(sortButtons, true);
                showToast(i18n.t('进入排序模式，拖动项目调整顺序（自动保存）'), 'success');
            }
            
            // 重新渲染列表
            if (listType === 'commands') {
                updateCommands();
            } else if (listType === 'variables') {
                updateVariablesList();
            } else if (listType === 'columns') {
                updateColumnsList();
            }
        }
        
        // 更新分栏列表
        function updateColumnsList() {
            const columnsList = document.getElementById('columnsList');
            if (!columnsList) return;
            
            // 保存当前排序状态
            const isSorting = activeSortListType === 'columns';
            
            columnsList.innerHTML = '';
            
            // 添加排序按钮
            const sortContainer = document.createElement('div');
            sortContainer.style.display = 'flex';
            sortContainer.style.justifyContent = 'flex-end';
            sortContainer.style.marginBottom = '1rem';
            
            // 根据当前排序状态设置按钮样式和文本
            const buttonStyle = isSorting ? 
                'background-color: var(--success-color);' : 
                'background-color: var(--primary-color);';
            
            const exitText = i18n.t('✓ 点击退出');
            const sortText = i18n.t('☰ 拖动排序');
            const buttonText = isSorting ? exitText : sortText;
            
            sortContainer.innerHTML = `
                <button onclick="toggleSortMode('columns')" data-sort-type="columns" class="sort-btn ${isSorting ? 'active' : ''}">
                    <span>${isSorting ? i18n.t('✓ 点击退出') : i18n.t('☰ 拖动排序')}</span>
                </button>
            `;
            columnsList.appendChild(sortContainer);
            
            if (columns.length === 0) {
                columnsList.innerHTML += '<p style="color: var(--text-secondary); text-align: center; padding: 2rem;">暂无分栏，请添加新分栏</p>';
                return;
            }
            
            columns.forEach((column, index) => {
                const columnItem = document.createElement('div');
                columnItem.className = 'command-item';
                columnItem.dataset.index = index;
                columnItem.dataset.listType = 'columns';
                
                columnItem.innerHTML = `
                    <div class="command-header">
                        <h3 class="command-title">
                            <span style="cursor: move; margin-right: 0.5rem; opacity: 0.6;">☰</span>
                            ${column.name}
                        </h3>
                        <div class="command-actions">
                            <button class="edit-btn" onclick="editColumn(${index})"></button>
                            <button class="delete-btn" onclick="deleteColumn(${index})"></button>
                        </div>
                    </div>
                `;
                
                // 更新按钮文本
                const editBtn = columnItem.querySelector('.edit-btn');
                const deleteBtn = columnItem.querySelector('.delete-btn');
                if (editBtn) editBtn.textContent = i18n.t('编辑');
                if (deleteBtn) deleteBtn.textContent = i18n.t('删除');
                
                // 添加拖动事件监听器（如果当前处于排序模式）
                if (isSorting) {
                    columnItem.draggable = true;
                    columnItem.style.cursor = 'move';
                    columnItem.addEventListener('dragstart', handleDragStart);
                    columnItem.addEventListener('dragover', handleDragOver);
                    columnItem.addEventListener('drop', handleDrop);
                    columnItem.addEventListener('dragend', handleDragEnd);
                }
                
                columnsList.appendChild(columnItem);
            });
            
            // 为容器添加dragover事件，以便在空白区域也能放置
            columnsList.addEventListener('dragover', (e) => {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
            });
        }
        
        // 添加新分栏
        function addColumn() {
            const nameInput = document.getElementById('newColumnName');
            
            const name = nameInput.value.trim();
            
            // 清除之前的错误
            nameInput.classList.remove('input-error');
            
            if (!name) {
                nameInput.classList.add('input-error');
                showToast(i18n.t('请输入分栏名称'), 'error');
                return;
            }
            
            // 生成唯一ID
            const id = `column_${Date.now()}_${Math.floor(Math.random() * 1000)}`;
            
            // 添加到分栏列表
            columns.push({
                id: id,
                name: name
            });
            
            // 保存数据到localStorage
            saveData();
            
            // 更新分栏列表
            updateColumnsList();
            
            // 更新命令管理中的分栏选择器
            updateColumnSelectors();
            
            // 更新分栏筛选器选项
            updateColumnFilter();
            
            // 更新左侧导航栏中的分栏菜单项
            generateSidebarColumns();
            
            // 清空输入框
            nameInput.value = '';
            
            // 显示成功提示
            showToast(i18n.t('分栏添加成功'), 'success');
        }
        
        // 打开分栏编辑模态框
        function openEditColumnModal(index) {
            const column = columns[index];
            currentEditColumnIndex = index;
            
            // 填充表单数据
            document.getElementById('editColumnName').value = column.name;
            
            // 清除错误信息
            document.getElementById('editColumnName').classList.remove('input-error');
            document.getElementById('editColumnNameError').textContent = '';
            
            // 显示模态框
            document.getElementById('editColumnModal').classList.add('show');
        }
        
        // 关闭分栏编辑模态框
        function closeEditColumnModal() {
            document.getElementById('editColumnModal').classList.remove('show');
            currentEditColumnIndex = -1;
        }
        
        // 保存编辑的分栏
        function saveEditedColumn() {
            if (currentEditColumnIndex === -1) return;
            
            const nameInput = document.getElementById('editColumnName');
            const name = nameInput.value.trim();
            
            // 清除之前的错误
            nameInput.classList.remove('input-error');
            document.getElementById('editColumnNameError').textContent = '';
            
            let hasError = false;
            
            if (!name) {
                nameInput.classList.add('input-error');
                document.getElementById('editColumnNameError').textContent = '分栏名称不能为空';
                hasError = true;
            }
            
            if (hasError) {
                showToast(i18n.t('请检查输入信息'), 'error');
                return;
            }
            
            // 更新分栏数据
            columns[currentEditColumnIndex].name = name;
            
            // 保存数据到localStorage
            saveData();
            
            // 更新分栏列表
            updateColumnsList();
            
            // 更新命令管理中的分栏选择器
            updateColumnSelectors();
            
            // 更新分栏筛选器选项
            updateColumnFilter();
            
            // 更新左侧导航栏中的分栏菜单项
            generateSidebarColumns();
            
            // 关闭模态框
            closeEditColumnModal();
            
            // 显示成功提示
            showToast(i18n.t('分栏编辑成功'), 'success');
        }
        
        // 编辑分栏
        function editColumn(index) {
            openEditColumnModal(index);
        }
        
        // 删除分栏
        function deleteColumn(index) {
            const column = columns[index];
            // 构建删除分栏的确认消息
            const confirmMessageKey = '确定要删除分栏 "%s" 吗？该分栏下的命令将恢复为未分配状态。';
            // 获取翻译后的消息，并替换占位符
            const translatedMessage = i18n.t(confirmMessageKey).replace('%s', column.name);
            
            showConfirmModal(
                i18n.t('确认删除分栏'),
                translatedMessage,
                () => {
                    // 先将该分栏下的命令恢复为未分配状态
                    commands.forEach(cmd => {
                        if (cmd.columnId === column.id) {
                            cmd.columnId = null;
                        }
                    });
                    
                    // 删除分栏
                    columns.splice(index, 1);
                    
                    // 保存数据到localStorage
                    saveData();
                    
                    // 更新分栏列表
                    updateColumnsList();
                    
                    // 更新命令管理中的分栏选择器
                    updateColumnSelectors();
                    
                    // 更新分栏筛选器选项
                    updateColumnFilter();
                    
                    // 更新左侧导航栏中的分栏菜单项
                    generateSidebarColumns();
                    
                    // 显示成功提示
                    showToast(i18n.t('分栏删除成功'), 'success');
                }
            );
        }
        
        // 更新所有分栏选择器
        function updateColumnSelectors() {
            // 分栏选择器的前缀列表
            const selectors = ['management-newCmdColumn', 'editCmdColumn'];
            
            selectors.forEach(selectorId => {
                const hiddenInput = document.getElementById(selectorId);
                if (!hiddenInput) return;
                
                // 获取相关元素
                const container = document.getElementById(`${selectorId}Container`);
                const optionsContainer = document.getElementById(`${selectorId}Options`);
                const placeholder = document.getElementById(`${selectorId}Placeholder`);
                const valueDisplay = document.getElementById(`${selectorId}Value`);
                
                if (!container || !optionsContainer || !placeholder || !valueDisplay) return;
                
                // 保存当前选中的值
                const currentValue = hiddenInput.value;
                
                // 清空选项
                optionsContainer.innerHTML = '';
                
                // 添加无分栏选项
                const noColumnOption = document.createElement('div');
                noColumnOption.style.padding = '0.5rem';
                noColumnOption.style.cursor = 'pointer';
                noColumnOption.style.transition = 'background-color 0.2s';
                noColumnOption.style.paddingLeft = '1rem';
                noColumnOption.style.borderLeft = `4px solid ${currentValue === '' ? 'var(--primary-color)' : 'transparent'}`;
                noColumnOption.onmouseenter = () => noColumnOption.style.backgroundColor = 'var(--bg-color)';
                noColumnOption.onmouseleave = () => noColumnOption.style.backgroundColor = '';
                noColumnOption.textContent = i18n.t('无分栏');
                noColumnOption.onclick = () => {
                    // 更新隐藏输入框的值
                    hiddenInput.value = '';
                    // 更新显示
                    placeholder.style.display = 'inline';
                    valueDisplay.style.display = 'none';
                    valueDisplay.textContent = '';
                    // 关闭选项列表
                    optionsContainer.style.display = 'none';
                    // 更新选项列表的选中状态
                    updateColumnSelectors();
                };
                optionsContainer.appendChild(noColumnOption);
                
                // 添加分栏选项
                columns.forEach(column => {
                    const option = document.createElement('div');
                    option.style.padding = '0.5rem';
                    option.style.cursor = 'pointer';
                    option.style.transition = 'background-color 0.2s';
                    option.style.paddingLeft = '1rem';
                    option.style.borderLeft = `4px solid ${currentValue === column.id ? 'var(--primary-color)' : 'transparent'}`;
                    option.onmouseenter = () => option.style.backgroundColor = 'var(--bg-color)';
                    option.onmouseleave = () => option.style.backgroundColor = '';
                    option.textContent = column.name;
                    option.onclick = () => {
                        // 更新隐藏输入框的值
                        hiddenInput.value = column.id;
                        // 更新显示
                        placeholder.style.display = 'none';
                        valueDisplay.style.display = 'inline';
                        valueDisplay.textContent = column.name;
                        // 关闭选项列表
                        optionsContainer.style.display = 'none';
                        // 更新选项列表的选中状态
                        updateColumnSelectors();
                    };
                    optionsContainer.appendChild(option);
                });
                
                // 更新显示
                const selectedColumn = columns.find(col => col.id === currentValue);
                if (selectedColumn) {
                    placeholder.style.display = 'none';
                    valueDisplay.style.display = 'inline';
                    valueDisplay.textContent = selectedColumn.name;
                } else {
                    placeholder.style.display = 'inline';
                    valueDisplay.style.display = 'none';
                    valueDisplay.textContent = '';
                }
            });
            
            // 不再重新生成侧边栏的分栏菜单项，避免在编辑命令页面中跳转到相应分栏
        }
        
        // 动态生成左侧主菜单中的分栏菜单项
        function generateSidebarColumns() {
            const tabList = document.querySelector('.tab-list:not(.bottom)');
            if (!tabList) return;
            
            // 找到主页面项
            const mainItem = tabList.querySelector('[data-tab="main"]');
            if (!mainItem) return;
            
            // 保存当前选中的菜单项
            let activeItem = document.querySelector('.tab-item.active');
            // 如果没有找到active类的标签，检查management-active类的标签
            if (!activeItem) {
                activeItem = document.querySelector('.tab-item.management-active');
            }
            const currentTab = activeItem ? activeItem.dataset.tab : 'main';
            
            // 清除现有的分栏菜单项（保留主页面项）
            const existingColumns = tabList.querySelectorAll('[data-tab^="column_"]');
            existingColumns.forEach(column => column.remove());
            
            // 先获取主页面项的父节点和下一个兄弟节点
            const parentNode = mainItem.parentNode;
            let lastColumnItem = mainItem;
            
            // 直接使用columns数组的顺序，不再按order属性排序
            columns.forEach(column => {
                const menuItem = document.createElement('div');
                menuItem.className = 'tab-item';
                menuItem.dataset.tab = 'column_' + column.id;
                menuItem.textContent = column.name;
                
                // 添加到主菜单中，放在上一个分栏项的后面
                parentNode.insertBefore(menuItem, lastColumnItem.nextSibling);
                lastColumnItem = menuItem;
            });
            
            // 重新初始化Tab系统，确保新添加的分栏菜单项有点击事件
            initTabSystem();
            
            // 恢复当前选中的菜单项，但不自动点击，避免页面跳转
            const newActiveItem = document.querySelector(`[data-tab="${currentTab}"]`);
            if (newActiveItem) {
                // 先移除所有标签的激活类
                const allTabItems = document.querySelectorAll('.tab-item');
                allTabItems.forEach(item => {
                    item.classList.remove('active');
                    item.classList.remove('management-active');
                });
                
                // 根据标签类型添加不同的激活类
                if (currentTab === 'management') {
                    newActiveItem.classList.add('management-active');
                } else {
                    newActiveItem.classList.add('active');
                }
            }
        }
        
        // 初始化分栏菜单
        function initColumnsMenu() {
            // 动态生成左侧主菜单中的分栏菜单项
            generateSidebarColumns();
        }
        
        // 初始化分栏选择器的下拉功能
        function initColumnSelectors() {
            // 分栏选择器的前缀列表
            const selectors = ['management-newCmdColumn', 'editCmdColumn'];
            
            selectors.forEach(selectorId => {
                const container = document.getElementById(`${selectorId}Container`);
                const optionsContainer = document.getElementById(`${selectorId}Options`);
                
                if (!container || !optionsContainer) return;
                
                // 点击容器时切换选项列表的显示状态
                container.addEventListener('click', (e) => {
                    // 阻止事件冒泡，避免触发外部的点击事件
                    e.stopPropagation();
                    
                    // 切换选项列表的显示状态
                    optionsContainer.style.display = optionsContainer.style.display === 'block' ? 'none' : 'block';
                });
            });
            
            // 点击页面其他地方时关闭所有选项列表
            document.addEventListener('click', () => {
                selectors.forEach(selectorId => {
                    const optionsContainer = document.getElementById(`${selectorId}Options`);
                    if (optionsContainer) {
                        optionsContainer.style.display = 'none';
                    }
                });
            });
        }
        
        // 初始化文件上传事件监听
        function initFileUploadListener() {
            const importFile = document.getElementById('importFile');
            const fileName = document.getElementById('fileName');
            
            if (importFile && fileName) {
                importFile.addEventListener('change', (e) => {
                    if (e.target.files.length > 0) {
                        fileName.textContent = e.target.files[0].name;
                    } else {
                        fileName.textContent = i18n.t('未选择文件');
                    }
                });
            }
        }
        
        // 初始化页面
        function init() {
            try {
                // 初始化语言设置
                const savedLanguage = localStorage.getItem('commandGeneratorLanguage');
                if (savedLanguage && (savedLanguage === 'zh' || savedLanguage === 'en')) {
                    currentLanguage = savedLanguage;
                }
                
                // 更新语言按钮状态
                const langZh = document.getElementById('lang-zh');
                const langEn = document.getElementById('lang-en');
                if (langZh) {
                    langZh.style.backgroundColor = currentLanguage === 'zh' ? 'white' : 'transparent';
                    langZh.style.color = currentLanguage === 'zh' ? 'var(--primary-color)' : 'rgba(255, 255, 255, 0.5)';
                }
                if (langEn) {
                    langEn.style.backgroundColor = currentLanguage === 'en' ? 'white' : 'transparent';
                    langEn.style.color = currentLanguage === 'en' ? 'var(--primary-color)' : 'rgba(255, 255, 255, 0.5)';
                }
                
                // 初始化其他功能
                initTabSystem();
                initSearch();
                initManagementSearch();
                initTagInput();
                initColumnsMenu();
                initColumnSelectors();
                initFileUploadListener();
                
                // 更新所有列表和内容
                updateLanguageContent();
                updateVariablesList();
                updateCustomTagFilter();
                updateCommands();
                updateCommandManagementList();
                updateVariableManagementList();
                updateColumnsList();
                updateColumnSelectors();
                updateColumnFilter();
                
                // 初始化变量管理按钮
                initVariablesToggle();
            } catch (error) {
                console.error('Error in init:', error);
                showToast(i18n.t('初始化失败，请刷新页面重试'), 'error');
            }
        }
        
        // 初始化变量管理按钮
        function initVariablesToggle() {
            const toggleBtn = document.getElementById('variablesToggleBtn');
            const variablesSection = document.querySelector('.variables-section');
            
            if (toggleBtn && variablesSection) {
                toggleBtn.addEventListener('click', () => {
                    variablesSection.classList.toggle('active');
                });
                
                // 添加点击外部关闭功能
                document.addEventListener('click', (e) => {
                    if (!variablesSection.contains(e.target) && 
                        !toggleBtn.contains(e.target) && 
                        variablesSection.classList.contains('active')) {
                        variablesSection.classList.remove('active');
                    }
                });
            }
        }
        
        // 初始化标签输入功能
        function initTagInput() {
            initNewCmdTagInput();
            initManagementNewCmdTagInput();
            initEditCmdTagInput();
        }
        
        // 初始化添加命令的标签输入
        function initNewCmdTagInput() {
            setupTagInput('newCmd');
        }
        
        // 初始化管理面板添加命令的标签输入
        function initManagementNewCmdTagInput() {
            setupTagInput('management-newCmd');
        }
        
        // 初始化编辑命令的标签输入
        function initEditCmdTagInput() {
            setupTagInput('editCmd');
        }
        
        // 设置标签输入功能
        function setupTagInput(prefix) {
            const container = document.getElementById(`${prefix}TagsContainer`);
            const options = document.getElementById(`${prefix}TagsOptions`);
            const placeholder = document.getElementById(`${prefix}TagsPlaceholder`);
            
            // 检查容器是否存在
            if (!container) return;
            
            // 移除容器中所有内容
            while (container.firstChild) {
                container.removeChild(container.firstChild);
            }
            
            // 创建一个隐藏的输入框来存储标签数据
            const hiddenInput = document.createElement('input');
            hiddenInput.type = 'hidden';
            hiddenInput.id = `${prefix}Tags`;
            container.appendChild(hiddenInput);
            
            // 创建一个可见的输入框，直接放在容器中
            const tagInput = document.createElement('input');
            tagInput.type = 'text';
            tagInput.id = `${prefix}TagInput`;
            tagInput.style.flex = '1';
            tagInput.style.minWidth = '100px';
            tagInput.style.fontSize = '0.9rem';
            tagInput.style.color = 'var(--text-primary)';
            tagInput.style.border = 'none';
            tagInput.style.outline = 'none';
            tagInput.style.background = 'transparent';
            tagInput.style.padding = '0.25rem 0';
            tagInput.style.margin = '0';
            tagInput.style.marginRight = '0.5rem';
            tagInput.style.placeholder = '';
            tagInput.style.boxShadow = 'none';
            tagInput.style.appearance = 'none';
            tagInput.style.borderRadius = '0';
            tagInput.style.lineHeight = '1.5';
            
            // 重置容器样式和属性
            container.contentEditable = 'false';
            container.style.cursor = 'text';
            
            // 添加占位符
            if (placeholder) {
                container.appendChild(placeholder);
            }
            // 添加输入框
            container.appendChild(tagInput);
            
            let currentTags = [];
            let isDropdownOpen = false;
            let isFocused = false;
            let isComposing = false;
            
            // 更新当前标签列表
            function updateCurrentTags() {
                hiddenInput.value = currentTags.join(',');
            }
            
            // 渲染现有标签选项
            function renderTagOptions() {
                if (!options) return;
                
                const allTags = getAllUniqueTags();
                options.innerHTML = '';
                
                if (allTags.length === 0) {
                    const noTagsMsg = document.createElement('div');
                    noTagsMsg.style.padding = '0.5rem';
                    noTagsMsg.style.color = 'var(--text-muted)';
                    noTagsMsg.style.textAlign = 'center';
                    noTagsMsg.textContent = '暂无标签，可直接输入新标签';
                    options.appendChild(noTagsMsg);
                    return;
                }
                
                allTags.forEach(tag => {
                    const option = document.createElement('div');
                    option.style.padding = '0.5rem';
                    option.style.cursor = 'pointer';
                    option.style.display = 'flex';
                    option.style.alignItems = 'center';
                    option.style.gap = '0.5rem';
                    option.style.transition = 'background-color 0.2s';
                    option.onmouseenter = () => option.style.backgroundColor = 'var(--bg-color)';
                    option.onmouseleave = () => option.style.backgroundColor = '';
                    
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.checked = currentTags.includes(tag);
                    checkbox.style.margin = '0';
                    
                    const tagText = document.createElement('span');
                    tagText.textContent = tag;
                    tagText.style.flex = '1';
                    tagText.style.cursor = 'pointer';
                    
                    option.addEventListener('click', (e) => {
                        // 切换复选框状态
                        checkbox.checked = !checkbox.checked;
                        if (checkbox.checked) {
                            if (!currentTags.includes(tag)) {
                                currentTags.push(tag);
                            }
                        } else {
                            currentTags = currentTags.filter(t => t !== tag);
                        }
                        renderTags();
                        renderTagOptions();
                        updateCurrentTags();
                    });
                    
                    // 点击复选框时直接处理
                    checkbox.addEventListener('click', (e) => {
                        e.stopPropagation(); // 阻止事件冒泡到option
                        if (checkbox.checked) {
                            if (!currentTags.includes(tag)) {
                                currentTags.push(tag);
                            }
                        } else {
                            currentTags = currentTags.filter(t => t !== tag);
                        }
                        renderTags();
                        renderTagOptions();
                        updateCurrentTags();
                    });
                    
                    option.appendChild(checkbox);
                    option.appendChild(tagText);
                    options.appendChild(option);
                });
            }
            
            // 渲染标签
            function renderTags() {
                if (!container) return;
                
                // 移除所有已有的标签元素（保留输入框和隐藏输入框）
                const elements = container.querySelectorAll(':scope > *');
                elements.forEach(el => {
                    if (el.className === 'selected-tag' || (placeholder && el.id === placeholder.id)) {
                        el.remove();
                    }
                });
                
                // 确定是否显示占位符
                const shouldShowPlaceholder = !isFocused && currentTags.length === 0 && !tagInput.value;
                
                if (shouldShowPlaceholder && placeholder) {
                    container.insertBefore(placeholder, tagInput);
                }
                
                // 添加所有标签，插入到输入框前面
                for (let i = 0; i < currentTags.length; i++) {
                    const tag = currentTags[i];
                    const tagElement = document.createElement('span');
                    tagElement.className = 'selected-tag';
                    tagElement.dataset.tag = tag;
                    
                    const tagText = document.createElement('span');
                    tagText.textContent = tag;
                    tagText.style.marginRight = '0.3rem';
                    
                    const deleteBtn = document.createElement('span');
                    deleteBtn.className = 'tag-delete-btn';
                    deleteBtn.textContent = '×';
                    deleteBtn.style.cursor = 'pointer';
                    deleteBtn.style.fontSize = '1rem';
                    deleteBtn.style.display = 'inline-block';
                    deleteBtn.style.width = '16px';
                    deleteBtn.style.height = '16px';
                    deleteBtn.style.textAlign = 'center';
                    deleteBtn.style.lineHeight = '14px';
                    deleteBtn.style.borderRadius = '50%';
                    deleteBtn.style.backgroundColor = 'rgba(255, 255, 255, 0.2)';
                    deleteBtn.style.transition = 'background-color 0.2s';
                    deleteBtn.style.userSelect = 'none';
                    
                    deleteBtn.addEventListener('mouseenter', () => {
                        deleteBtn.style.backgroundColor = 'rgba(255, 255, 255, 0.3)';
                    });
                    deleteBtn.addEventListener('mouseleave', () => {
                        deleteBtn.style.backgroundColor = 'rgba(255, 255, 255, 0.2)';
                    });
                    
                    deleteBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const tagToRemove = tagElement.dataset.tag;
                        currentTags = currentTags.filter(t => t !== tagToRemove);
                        renderTags();
                        renderTagOptions(); // 更新下拉列表中的勾选状态
                        updateCurrentTags();
                    });
                    
                    tagElement.appendChild(tagText);
                    tagElement.appendChild(deleteBtn);
                    container.insertBefore(tagElement, tagInput);
                }
            }
            
            // 显示标签选项
            function showTagOptions() {
                renderTagOptions();
                if (options) {
                    options.style.display = 'block';
                    isDropdownOpen = true;
                }
            }
            
            // 隐藏标签选项
            function hideTagOptions() {
                if (options) {
                    options.style.display = 'none';
                    isDropdownOpen = false;
                }
            }
            
            // 添加标签
            function addTag() {
                const tagValue = tagInput.value.trim();
                if (tagValue && !currentTags.includes(tagValue)) {
                    currentTags.push(tagValue);
                    tagInput.value = '';
                    renderTags();
                    updateCurrentTags();
                    hideTagOptions();
                }
            }
            
            // 处理按键事件
            function handleKeyDown(e) {
                if (e.key === 'Enter' || e.key === ',') {
                    e.preventDefault();
                    addTag();
                } else if (e.key === 'Backspace') {
                    if (!tagInput.value && currentTags.length > 0) {
                        e.preventDefault();
                        currentTags.pop();
                        renderTags();
                        updateCurrentTags();
                    }
                } else if (e.key === 'Escape') {
                    e.preventDefault();
                    hideTagOptions();
                }
            }
            
            // 容器点击事件
            container.addEventListener('click', () => {
                tagInput.focus();
                if (!isDropdownOpen) {
                    showTagOptions();
                }
            });
            
            // 中文输入相关事件
            tagInput.addEventListener('compositionstart', () => {
                isComposing = true;
            });
            
            tagInput.addEventListener('compositionupdate', () => {
                // 中文输入过程中不更新标签
            });
            
            tagInput.addEventListener('compositionend', () => {
                isComposing = false;
                renderTags();
                if (!isDropdownOpen && tagInput.value.trim()) {
                    showTagOptions();
                }
            });
            
            // 输入事件
            tagInput.addEventListener('input', () => {
                if (!isComposing) {
                    renderTags();
                    if (!isDropdownOpen && tagInput.value.trim()) {
                        showTagOptions();
                    }
                }
            });
            
            // 焦点事件
            tagInput.addEventListener('focus', () => {
                isFocused = true;
                renderTags();
            });
            
            tagInput.addEventListener('blur', () => {
                setTimeout(() => {
                    if (!container.contains(document.activeElement) && !options.contains(document.activeElement)) {
                        isFocused = false;
                        if (!tagInput.value) {
                            renderTags();
                        }
                    }
                }, 200);
            });
            
            // 点击页面其他地方关闭标签选项
            document.addEventListener('click', (e) => {
                if (!container.contains(e.target) && !options.contains(e.target)) {
                    hideTagOptions();
                }
            });
            
            // 确保选项点击不会关闭下拉框
            options.addEventListener('click', (e) => {
                e.stopPropagation();
            });
            
            // 添加事件监听
            tagInput.addEventListener('keydown', handleKeyDown);
            
            // 获取当前标签列表
            const camelCasePrefix = prefix.replace(/-([a-z])/g, (g) => g[1].toUpperCase());
            const getTagsFunctionName = `get${camelCasePrefix.charAt(0).toUpperCase() + camelCasePrefix.slice(1)}Tags`;
            const setTagsFunctionName = `set${camelCasePrefix.charAt(0).toUpperCase() + camelCasePrefix.slice(1)}Tags`;
            
            window[getTagsFunctionName] = () => {
                const tagValue = tagInput.value.trim();
                if (tagValue && !currentTags.includes(tagValue)) {
                    currentTags.push(tagValue);
                    tagInput.value = '';
                    renderTags();
                    updateCurrentTags();
                }
                return currentTags;
            };
            
            window[setTagsFunctionName] = (tags) => {
                currentTags = tags;
                tagInput.value = '';
                renderTags();
                updateCurrentTags();
            };
            
            // 初始渲染
            renderTags();
        }





            
        // 复制命令到剪贴板
        function copyCommand(btn) {
            const pre = btn.nextElementSibling;
            const text = pre.textContent;
            
            navigator.clipboard.writeText(text).then(() => {
                const copiedText = i18n.t('已复制');
                btn.textContent = copiedText;
                btn.classList.add('copied');
                btn.style.backgroundColor = 'var(--success-color)';
                
                // 显示复制成功提示
                const copySuccessText = i18n.t('命令已复制到剪贴板');
                showToast(copySuccessText, 'success');
                
                setTimeout(() => {
                    const copyText = i18n.t('复制');
                    btn.textContent = copyText;
                    btn.classList.remove('copied');
                    btn.style.backgroundColor = 'rgba(128, 128, 128, 0.5)';
                }, 2000);
            }).catch(err => {
                console.error('复制失败:', err);
                showToast(i18n.t('复制失败，请重试'), 'error');
            });
        }

        // 编辑变量值
        function editVariable(element) {
            const currentValue = element.textContent;
            const input = document.createElement('input');
            input.type = 'text';
            input.value = currentValue;
            input.className = 'variable-value editing';
            
            // 替换当前元素为输入框
            const parent = element.parentElement;
            parent.replaceChild(input, element);
            
            // 自动聚焦
            input.focus();
            input.select();
            
            // 创建保存函数，确保只执行一次
            let saved = false;
            const saveAction = () => {
                if (!saved) {
                    saved = true;
                    // 先移除事件监听器，防止重复触发
                    input.removeEventListener('blur', saveAction);
                    input.removeEventListener('keypress', handleKeyPress);
                    saveVariable(parent, input.value);
                }
            };
            
            // 按下Enter键保存
            const handleKeyPress = (e) => {
                if (e.key === 'Enter') {
                    saveAction();
                }
            };
            
            // 添加事件监听器
            input.addEventListener('blur', saveAction);
            input.addEventListener('keypress', handleKeyPress);
        }

        // 保存变量值
        function saveVariable(parent, newValue) {
            // 获取data-varName属性值作为变量名，确保使用大写
            const originalVariableName = parent.dataset.varName;
            if (!originalVariableName) return;
            
            const variableName = originalVariableName.toUpperCase();
            const div = document.createElement('div');
            div.className = 'variable-value';
            div.textContent = newValue;
            div.onclick = () => editVariable(div);
            
            // 检查输入框是否还存在于DOM中，避免重复保存导致的错误
            const input = parent.querySelector('input');
            if (input) {
                parent.replaceChild(div, input);
                
                // 更新变量存储，始终使用大写的变量名
                variables[variableName] = newValue;
                
                // 保存数据到localStorage
                saveData();
                
                // 更新所有命令
                updateCommands();
                
                // 更新变量管理列表
                updateVariableManagementList();
            }
        }



        // 更新所有命令 - 主页面不显示编辑和删除按钮，但显示描述和标签，支持标签筛选和搜索
        function updateCommands() {
            const commandsList = document.getElementById('commandsList');
            if (!commandsList) return;
            
            // 更新命令列表标题为当前分栏名称
            const commandsTitle = document.querySelector('.commands-section h2');
            if (commandsTitle) {
                if (activeColumnId) {
                    // 查找对应的分栏名称
                    const column = columns.find(col => col.id === activeColumnId);
                    if (column) {
                        commandsTitle.textContent = column.name;
                    } else {
                        commandsTitle.textContent = i18n.t('命令列表');
                    }
                } else {
                    commandsTitle.textContent = i18n.t('命令列表');
                }
            }
            
            commandsList.innerHTML = '';
            
            // 按sortOrder排序命令
            const sortedCommands = [...commands].sort((a, b) => a.sortOrder - b.sortOrder);
            
            // 添加排序按钮
            const sortContainer = document.createElement('div');
            sortContainer.style.display = 'flex';
            sortContainer.style.justifyContent = 'flex-end';
            sortContainer.style.marginBottom = '1rem';
            
            // 根据当前排序状态设置按钮样式和文本
            const isSorting = activeSortListType === 'commands';
            const buttonStyle = isSorting ? 
                'background-color: var(--success-color);' : 
                'background-color: var(--primary-color);';
            
            const exitText = i18n.t('✓ 点击退出');
            const sortText = i18n.t('☰ 拖动排序');
            const buttonText = isSorting ? exitText : sortText;
            
            sortContainer.innerHTML = `
                <button onclick="toggleSortMode('commands')" data-sort-type="commands" class="sort-btn ${isSorting ? 'active' : ''}">
                    <span>${isSorting ? i18n.t('✓ 点击退出') : i18n.t('☰ 拖动排序')}</span>
                </button>
            `;
            commandsList.appendChild(sortContainer);
            
            sortedCommands.forEach((command, index) => {
                let showCommand = true;
                
                // 1. 分栏筛选
                if (activeColumnId) {
                    if (command.columnId !== activeColumnId) {
                        showCommand = false;
                    }
                }
                
                // 2. 标签筛选
                if (showCommand && activeTags.length > 0) {
                    const hasMatchingTag = command.tags.some(tag => activeTags.includes(tag));
                    if (!hasMatchingTag) {
                        showCommand = false;
                    }
                }
                
                // 3. 搜索筛选
                if (showCommand && searchKeyword) {
                    const searchableText = `${command.title} ${command.description || ''} ${command.template}`.toLowerCase();
                    if (!searchableText.includes(searchKeyword)) {
                        showCommand = false;
                    }
                }
                
                // 如果不匹配，跳过
                if (!showCommand) {
                    return;
                }
                
                let commandText = command.template || command.commands?.join('\n') || '';
                let commandLines = [];
                
                // 替换所有变量 - 使用${{变量名}}格式
                for (const varName in variables) {
                    // 创建替换值，当值为空时使用[变量名]作为默认值
                    let value = variables[varName];
                    // 确保value是字符串类型
                    if (typeof value !== 'string') {
                        value = `[${varName}]`;
                    } else if (!value || value.trim() === '') {
                        value = `[${varName}]`;
                    }
                    
                    // 处理所有可能的大小写形式
                    const lowercasePattern = `\${{${varName.toLowerCase()}}}`;
                    commandText = commandText.split(lowercasePattern).join(value);
                    
                    const uppercasePattern = `\${{${varName.toUpperCase()}}}`;
                    commandText = commandText.split(uppercasePattern).join(value);
                    
                    const originalPattern = `\${{${varName}}}`;
                    commandText = commandText.split(originalPattern).join(value);
                }
                
                // 解析命令文本，处理 ---script--- 和 ---end--- 标记
                const lines = commandText.split('\n');
                let inScriptBlock = false;
                let currentBlock = [];
                
                lines.forEach(line => {
                    const trimmedLine = line.trim();
                    
                    if (trimmedLine === '---script---') {
                        // 开始脚本块
                        if (currentBlock.length > 0) {
                            // 保存之前的代码块
                            commandLines.push(currentBlock.join('\n').trim());
                            currentBlock = [];
                        }
                        inScriptBlock = true;
                    } else if (trimmedLine === '---end---') {
                        // 结束脚本块
                        if (currentBlock.length > 0) {
                            // 保存脚本块
                            commandLines.push(currentBlock.join('\n').trim());
                            currentBlock = [];
                        }
                        inScriptBlock = false;
                    } else if (inScriptBlock) {
                        // 在脚本块内，添加到当前块
                        currentBlock.push(line);
                    } else {
                        // 不在脚本块内，每行作为一个代码块
                        if (trimmedLine !== '') {
                            commandLines.push(line.trim());
                        }
                    }
                });
                
                // 保存最后一个代码块
                if (currentBlock.length > 0) {
                    commandLines.push(currentBlock.join('\n').trim());
                }
                
                // 过滤空代码块
                commandLines = commandLines.filter(line => line.trim() !== '');
                
                // 如果没有代码块，添加一个空代码块
                if (commandLines.length === 0) {
                    commandLines.push('');
                }
                
                let descriptionHtml = '';
                if (command.description) {
                    descriptionHtml = `<div class="command-description" style="color: var(--text-secondary); margin: 0.5rem 0;">${command.description}</div>`;
                }
                
                // 创建命令项
                const commandItem = document.createElement('div');
                commandItem.className = 'command-item';
                commandItem.dataset.listType = 'commands';
                commandItem.dataset.index = commands.indexOf(command);
                
                // 命令头和描述
                commandItem.innerHTML = `
                    <div class="command-header">
                        <h3 class="command-title">
                            <span style="cursor: move; margin-right: 0.5rem; opacity: 0.6;">☰</span>
                            ${command.title}
                        </h3>
                        <!-- 主页面不显示编辑和删除按钮 -->
                    </div>
                    ${descriptionHtml}
                    ${renderTags(command.tags)}
                `;
                
                // 为每一行命令创建一个代码块
                const copyText = i18n.t('复制');
                commandLines.forEach((line, lineIndex) => {
                    // 创建代码块元素
                    const codeBlock = document.createElement('div');
                    codeBlock.className = 'code-block';
                    codeBlock.style.cssText = 'cursor: pointer; margin-top: 1rem;';
                    
                    // 创建复制按钮
                    const copyBtn = document.createElement('button');
                    copyBtn.className = 'copy-btn';
                    copyBtn.textContent = copyText;
                    copyBtn.onclick = function() { copyCommand(this); };
                    
                    // 创建pre元素
                    const pre = document.createElement('pre');
                    pre.id = `command${index + 1}_${lineIndex + 1}`;
                    pre.textContent = line;
                    
                    // 组装代码块
                    codeBlock.appendChild(copyBtn);
                    codeBlock.appendChild(pre);
                    
                    // 添加到命令项
                    commandItem.appendChild(codeBlock);
                });
                
                // 添加点击代码块复制功能
                const codeBlocks = commandItem.querySelectorAll('.code-block');
                codeBlocks.forEach(codeBlock => {
                    codeBlock.addEventListener('click', (e) => {
                        // 如果点击的是复制按钮，不执行点击代码块的复制操作
                        if (e.target.classList.contains('copy-btn')) {
                            return;
                        }
                        
                        const pre = codeBlock.querySelector('pre');
                        const text = pre.textContent;
                        
                        navigator.clipboard.writeText(text).then(() => {
                                // 显示复制成功提示
                                const copySuccessText = i18n.t('命令已复制到剪贴板');
                                showToast(copySuccessText, 'success');
                                
                                // 暂时改变按钮文本为"已复制"
                                const copyBtn = codeBlock.querySelector('.copy-btn');
                                const copiedText = i18n.t('已复制');
                                copyBtn.textContent = copiedText;
                                copyBtn.classList.add('copied');
                                copyBtn.style.backgroundColor = 'var(--success-color)';
                                
                                setTimeout(() => {
                                    const copyText = i18n.t('复制');
                                    copyBtn.textContent = copyText;
                                    copyBtn.classList.remove('copied');
                                    copyBtn.style.backgroundColor = 'rgba(128, 128, 128, 0.5)';
                                }, 2000);
                            }).catch(err => {
                                console.error('复制失败:', err);
                                showToast(i18n.t('复制失败，请重试'), 'error');
                            });
                    });
                });
                
                // 添加拖动事件监听器（如果当前处于排序模式）
                if (activeSortListType === 'commands') {
                    commandItem.draggable = true;
                    commandItem.style.cursor = 'move';
                    commandItem.addEventListener('dragstart', handleDragStart);
                    commandItem.addEventListener('dragover', handleDragOver);
                    commandItem.addEventListener('drop', handleDrop);
                    commandItem.addEventListener('dragend', handleDragEnd);
                }
                
                commandsList.appendChild(commandItem);
            });
            
            // 更新变量列表，确保只显示当前命令使用的变量
            updateVariablesList();
        }

        // 添加新变量
        function addVariable() {
            const nameInput = document.getElementById('newVarName');
            const name = nameInput.value.trim().toUpperCase();
            
            // 清除之前的错误
            nameInput.classList.remove('input-error');
            
            if (!name) {
                nameInput.classList.add('input-error');
                showToast(i18n.t('请输入变量名'), 'error');
                return;
            }
            
            if (variables[name]) {
                nameInput.classList.add('input-error');
                showToast(i18n.t('变量名已存在'), 'error');
                return;
            }
            
            // 添加到变量存储，使用空字符串作为默认值
            variables[name] = '';
            
            // 将新变量添加到排序数组中
            variableOrder.push(name);
            
            // 保存数据到localStorage
            saveData();
            
            // 更新所有相关列表
            updateVariablesList();
            updateCommands();
            updateVariableManagementList();
            
            // 清空输入框
            nameInput.value = '';
            
            // 显示成功提示
            showToast(i18n.t('变量添加成功'), 'success');
        }
        
        // 从管理面板添加新变量
        function addManagementVariable() {
            const nameInput = document.getElementById('management-newVarName');
            const name = nameInput.value.trim().toUpperCase();
            
            // 清除之前的错误
            nameInput.classList.remove('input-error');
            
            if (!name) {
                nameInput.classList.add('input-error');
                showToast(i18n.t('请输入变量名'), 'error');
                return;
            }
            
            if (variables[name]) {
                nameInput.classList.add('input-error');
                showToast(i18n.t('变量名已存在'), 'error');
                return;
            }
            
            // 添加到变量存储，使用空字符串作为默认值
            variables[name] = '';
            
            // 将新变量添加到排序数组中
            variableOrder.push(name);
            
            // 保存数据到localStorage
            saveData();
            
            // 更新所有相关列表
            updateVariablesList();
            updateCommands();
            updateVariableManagementList();
            
            // 清空输入框
            nameInput.value = '';
            
            // 显示成功提示
            showToast(i18n.t('变量添加成功'), 'success');
        }

        // 删除变量
        function deleteVariable(name) {
            // 转换为大写
            const upperCaseName = name.toUpperCase();
            showConfirmModal(
                '确认删除变量',
                `确定要删除变量 ${upperCaseName} 吗？`,
                () => {
                    delete variables[upperCaseName];
                    
                    // 从排序数组中移除变量
                    variableOrder = variableOrder.filter(varName => varName !== upperCaseName);
                    
                    // 保存数据到localStorage
                    saveData();
                    
                    // 更新所有相关列表
                    updateVariablesList();
                    updateCommands();
                    updateVariableManagementList();
                    
                    // 显示成功提示
                    showToast(i18n.t('变量删除成功'), 'success');
                }
            );
        }

        // 解析标签字符串为数组
        function parseTags(tagsString) {
            return tagsString
                .split(',')
                .map(tag => tag.trim())
                .filter(tag => tag.length > 0);
        }

        // 添加新命令 - 自动添加新变量
        function addCommand() {
            const titleInput = document.getElementById('newCmdTitle');
            const descriptionInput = document.getElementById('newCmdDescription');
            const templateInput = document.getElementById('newCmdTemplate');
            
            const title = titleInput.value.trim();
            const description = descriptionInput.value.trim();
            const tags = getNewCmdTags();
            let template = templateInput.value.trim();
            
            // 将命令模板中的变量名转换为大写
            template = template.replace(/\$\{\{([A-Za-z0-9_]+)\}\}/g, (match, varName) => {
                return `\${{${varName.toUpperCase()}}}`;
            });
            
            // 清除之前的错误
            titleInput.classList.remove('input-error');
            templateInput.classList.remove('input-error');
            
            if (!title) {
                titleInput.classList.add('input-error');
                showToast(i18n.t('请输入命令标题'), 'error');
                return;
            }
            
            if (!template) {
                templateInput.classList.add('input-error');
                showToast(i18n.t('请输入命令模板'), 'error');
                return;
            }
            
            // 自动添加命令中的新变量
            const hasNewVariable = autoAddVariablesFromCommand(template);
            
            // 添加到命令存储
            commands.push({
                title: title,
                description: description,
                tags: tags,
                template: template,
                columnId: null,
                sortOrder: commands.length
            });
            
            // 保存数据到localStorage
            saveData();
            
            // 更新所有相关列表
            updateCustomTagFilter(); // 新命令可能包含新标签
            updateCommands();
            updateVariablesList(); // 新命令可能包含新变量
            updateCommandManagementList();
            updateVariableManagementList(); // 如果有新变量，更新变量管理列表
            
            // 清空输入框
            titleInput.value = '';
            descriptionInput.value = '';
            templateInput.value = '';
            
            // 显示成功提示
            let message = i18n.t('命令添加成功');
            if (hasNewVariable) {
                message += i18n.t('，已自动添加新变量');
            }
            showToast(message, 'success');
        }
        
        // 从管理面板添加新命令
        function addManagementCommand() {
            const titleInput = document.getElementById('management-newCmdTitle');
            const descriptionInput = document.getElementById('management-newCmdDescription');
            const templateInput = document.getElementById('management-newCmdTemplate');
            const columnSelect = document.getElementById('management-newCmdColumn');
            
            const title = titleInput.value.trim();
            const description = descriptionInput.value.trim();
            const tags = window['getManagementNewCmdTags'] ? window['getManagementNewCmdTags']() : [];
            let template = templateInput.value.trim();
            const columnId = columnSelect ? columnSelect.value : '';
            
            // 将命令模板中的变量名转换为大写
            template = template.replace(/\$\{\{([A-Za-z0-9_]+)\}\}/g, (match, varName) => {
                return `\${{${varName.toUpperCase()}}}`;
            });
            
            // 清除之前的错误
            titleInput.classList.remove('input-error');
            templateInput.classList.remove('input-error');
            
            if (!title) {
                titleInput.classList.add('input-error');
                showToast(i18n.t('请输入命令标题'), 'error');
                return;
            }
            
            if (!template) {
                templateInput.classList.add('input-error');
                showToast(i18n.t('请输入命令模板'), 'error');
                return;
            }
            
            // 自动添加命令中的新变量
            const hasNewVariable = autoAddVariablesFromCommand(template);
            
            // 添加到命令存储
            commands.push({
                title: title,
                description: description,
                tags: tags,
                template: template,
                columnId: columnId || null,
                sortOrder: commands.length
            });
            
            // 保存数据到localStorage
            saveData();
            
            // 更新所有相关列表
            updateCustomTagFilter(); // 新命令可能包含新标签
            updateCommands();
            updateVariablesList(); // 新命令可能包含新变量
            updateCommandManagementList();
            updateVariableManagementList(); // 如果有新变量，更新变量管理列表
            
            // 清空输入框
            titleInput.value = '';
            descriptionInput.value = '';
            templateInput.value = '';
            if (columnSelect) {
                columnSelect.value = '';
            }
            
            // 显示成功提示
            let message = i18n.t('命令添加成功');
            if (hasNewVariable) {
                message += i18n.t('，已自动添加新变量');
            }
            showToast(message, 'success');
        }

        // 删除命令
        function deleteCommand(index) {
            showConfirmModal(
                '确认删除命令',
                `确定要删除命令 "${commands[index].title}" 吗？`,
                () => {
                    commands.splice(index, 1);
                    
                    // 保存数据到localStorage
                    saveData();
                    
                    // 更新所有相关列表
                    updateCustomTagFilter(); // 删除命令可能移除标签
                    updateCommands();
                    updateVariablesList(); // 删除命令可能减少变量
                    updateCommandManagementList();
                    
                    // 显示成功提示
                    showToast(i18n.t('命令删除成功'), 'success');
                }
            );
        }

        // 打开编辑命令模态框
        function openEditModal(index) {
            currentEditIndex = index;
            const command = commands[index];
            
            document.getElementById('editCmdTitle').value = command.title;
            document.getElementById('editCmdDescription').value = command.description || '';
            setEditCmdTags(command.tags || []);
            
            // 将命令模板中的变量名转换为大写
            let processedTemplate = command.template || command.commands?.join('\n') || '';
            processedTemplate = processedTemplate.replace(/\$\{\{([A-Za-z0-9_]+)\}\}/g, (match, varName) => {
                return `\${{${varName.toUpperCase()}}}`;
            });
            document.getElementById('editCmdTemplate').value = processedTemplate;
            
            document.getElementById('editCmdColumn').value = command.columnId || '';
            // 不再调用updateColumnSelectors，避免重新生成侧边栏导致页面跳转
            document.getElementById('editModal').classList.add('show');
        }

        // 关闭编辑命令模态框
        function closeEditModal() {
            document.getElementById('editModal').classList.remove('show');
            currentEditIndex = -1;
        }

        // 保存编辑后的命令 - 自动添加新变量
        function saveEditedCommand() {
            if (currentEditIndex === -1) return;
            
            const titleInput = document.getElementById('editCmdTitle');
            const descriptionInput = document.getElementById('editCmdDescription');
            const templateInput = document.getElementById('editCmdTemplate');
            const columnSelect = document.getElementById('editCmdColumn');
            
            const title = titleInput.value.trim();
            const description = descriptionInput.value.trim();
            const tags = getEditCmdTags();
            let template = templateInput.value.trim();
            const columnId = columnSelect.value || null;
            
            // 清除之前的错误
            titleInput.classList.remove('input-error');
            templateInput.classList.remove('input-error');
            document.getElementById('editCmdTitleError').textContent = '';
            document.getElementById('editCmdTemplateError').textContent = '';
            
            let hasError = false;
            
            if (!title) {
                titleInput.classList.add('input-error');
                document.getElementById('editCmdTitleError').textContent = '请输入命令标题';
                hasError = true;
            }
            
            if (!template) {
                templateInput.classList.add('input-error');
                document.getElementById('editCmdTemplateError').textContent = '请输入命令模板';
                hasError = true;
            }
            
            if (hasError) {
                return;
            }
            
            // 将命令模板中的变量名转换为大写
            template = template.replace(/\$\{\{([A-Za-z0-9_]+)\}\}/g, (match, varName) => {
                return `\${{${varName.toUpperCase()}}}`;
            });
            
            // 自动添加命令中的新变量
            const hasNewVariable = autoAddVariablesFromCommand(template);
            
            // 更新命令
            commands[currentEditIndex] = {
                title: title,
                description: description,
                tags: tags,
                template: template,
                columnId: columnId
            };
            
            // 保存数据到localStorage
            saveData();
            
            // 更新所有相关列表
            updateCustomTagFilter(); // 编辑命令可能修改标签
            updateCommands();
            updateVariablesList(); // 编辑命令可能改变变量
            updateCommandManagementList();
            updateVariableManagementList(); // 如果有新变量，更新变量管理列表
            
            // 显示成功提示
            let message = i18n.t('命令编辑成功');
            if (hasNewVariable) {
                message += i18n.t('，已自动添加新变量');
            }
            showToast(message, 'success');
            
            // 关闭模态框
            closeEditModal();
        }

        // 数据导出功能
        function exportData() {
            const data = {
                variables: variables,
                commands: commands,
                columns: columns,
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `command-generator-data-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
            showToast(i18n.t('数据导出成功'), 'success');
        }

        // 数据导入功能
        function importData() {
            const fileInput = document.getElementById('importFile');
            const importTypeElement = document.querySelector('input[name="importType"]:checked');
            const importType = importTypeElement ? importTypeElement.value : 'full';
            
            if (!fileInput.files || fileInput.files.length === 0) {
                showToast(i18n.t('请选择要导入的JSON文件'), 'error');
                return;
            }
            
            const file = fileInput.files[0];
            const reader = new FileReader();
            
            reader.onload = (event) => {
                try {
                    const importedData = JSON.parse(event.target.result);
                    
                    if (!importedData.variables || !importedData.commands) {
                        throw new Error('无效的数据格式：缺少变量或命令数据');
                    }
                    
                    // 处理命令数据，确保每个命令都有type和commands字段
                    const processedCommands = importedData.commands.map(cmd => ({
                        ...cmd,
                        type: cmd.type || 'single',
                        commands: cmd.commands || []
                    }));
                    
                    if (importType === 'full') {
                        // 全新导入：覆盖现有数据
                        // 处理variables对象，确保它是简单的键值对结构
                        variables = {};
                        for (const key in importedData.variables) {
                            if (importedData.variables.hasOwnProperty(key)) {
                                const varObj = importedData.variables[key];
                                variables[key] = typeof varObj === 'string' ? varObj : (varObj.value || '');
                            }
                        }
                        commands = processedCommands;
                        // 导入分栏数据（如果存在）
                        columns = importedData.columns || [];
                        // 更新变量排序顺序
                        variableOrder = Object.keys(variables).sort();
                        showToast(i18n.t('数据导入成功'), 'success');
                    } else {
                        // 增量导入：合并现有数据
                        // 处理导入的variables对象，确保它是简单的键值对结构
                        const importedVariables = {};
                        for (const key in importedData.variables) {
                            if (importedData.variables.hasOwnProperty(key)) {
                                const varObj = importedData.variables[key];
                                importedVariables[key] = typeof varObj === 'string' ? varObj : (varObj.value || '');
                            }
                        }
                        // 合并变量：新变量覆盖旧变量
                        variables = { ...variables, ...importedVariables };
                        
                        // 合并命令：避免重复，使用标题作为唯一标识
                        const existingTitles = new Set(commands.map(cmd => cmd.title));
                        const newCommands = processedCommands.filter(cmd => !existingTitles.has(cmd.title));
                        commands = [...commands, ...newCommands];
                        
                        // 合并分栏数据：避免重复，使用ID作为唯一标识
                        if (importedData.columns) {
                            const existingColumnIds = new Set(columns.map(col => col.id));
                            const newColumns = importedData.columns.filter(col => !existingColumnIds.has(col.id));
                            columns = [...columns, ...newColumns];
                        }
                        
                        // 更新变量排序顺序：保留原有顺序，新变量添加到末尾
                        const newVariableNames = Object.keys(importedVariables).filter(name => !variableOrder.includes(name));
                        variableOrder = [...variableOrder, ...newVariableNames].filter(name => variables.hasOwnProperty(name));
                        showToast(`${i18n.t('数据导入成功')}，新增${newCommands.length}条命令`, 'success');
                    }
                    
                    // 保存数据到localStorage
                    saveData();
                    
                    // 重新初始化页面
                    init();
                    
                    // 清空文件输入
                    fileInput.value = '';
                    
                } catch (error) {
                    showToast(`数据导入失败：${error.message}`, 'error');
                }
            };
            
            reader.onerror = () => {
                showToast(i18n.t('文件读取失败'), 'error');
            };
            
            reader.readAsText(file);
        }

        // 清除所有数据功能
        function clearAllData() {
            showConfirmModal(
                i18n.t('警告：删除所有数据'),
                i18n.t('此操作将永久删除所有数据，包括所有命令、变量和分栏！\n\n您确定要继续吗？'),
                () => {
                    // 第二次确认
                    showConfirmModal(
                        i18n.t('再次确认删除'),
                        i18n.t('请再次确认：此操作不可恢复，所有数据将被永久删除！'),
                        () => {
                            // 清除所有数据
                            variables = {};
                            commands = [];
                            columns = [];
                            
                            // 清空localStorage
                            localStorage.removeItem('commandGeneratorVariables');
                            localStorage.removeItem('commandGeneratorCommands');
                            localStorage.removeItem('commandGeneratorColumns');
                            // 设置清除数据标志
                            localStorage.setItem('commandGeneratorHasClearedData', 'true');
                            
                            // 重新初始化页面
                            init();
                            
                            showToast(i18n.t('所有数据已清除'), 'success');
                        }
                    );
                }
            );
        }

        // 点击模态框外部不关闭弹窗，必须点击确认或取消按钮
        window.onclick = function(event) {
            // 空函数，不执行任何操作
            // 这样点击弹窗外不会关闭弹窗
        }

        // 初始化
        init();
    </script>
</body>
</html>
